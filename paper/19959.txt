NBER WORKING PAPER SERIES

MATCHING METHODS IN PRACTICE:
THREE EXAMPLES
Guido W. Imbens
Working Paper 19959
http://www.nber.org/papers/w19959

NATIONAL BUREAU OF ECONOMIC RESEARCH
1050 Massachusetts Avenue
Cambridge, MA 02138
March 2014

Financial support for this research was generously provided through NSF grants SES 0452590 and
0820361. This paper was prepared for the Journal of Human Resources. I am grateful for comments
by three anonyous referees and the editor Sandra Black which greatly improved the presentation. This
work builds on previous work coauthored with Alberto Abadie, Joshua Angrist, Susan Athey, Keisuke
Hirano, Geert Ridder, Donald Rubin, and Jeffrey Wooldridge. I have learned much about these issues
from them, and their influence is apparent throughout the paper, but they are not responsible for any
errors or any of the views expressed here. The views expressed herein are those of the author and do
not necessarily reflect the views of the National Bureau of Economic Research.
NBER working papers are circulated for discussion and comment purposes. They have not been peerreviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.
© 2014 by Guido W. Imbens. All rights reserved. Short sections of text, not to exceed two paragraphs,
may be quoted without explicit permission provided that full credit, including © notice, is given to
the source.

Matching Methods in Practice: Three Examples
Guido W. Imbens
NBER Working Paper No. 19959
March 2014
JEL No. C1
ABSTRACT
There is a large theoretical literature on methods for estimating causal effects under unconfoundedness,
exogeneity, or selection--on--observables type assumptions using matching or propensity score methods.
Much of this literature is highly technical and has not made inroads into empirical practice where many
researchers continue to use simple methods such as ordinary least squares regression even in settings
where those methods do not have attractive properties. In this paper I discuss some of the lessons for
practice from the theoretical literature, and provide detailed recommendations on what to do. I illustrate
the recommendations with three detailed applications.

Guido W. Imbens
Graduate School of Business
Stanford University
655 Knight Way
Stanford, CA 94305
and NBER
Imbens@stanford.edu

1

Introduction

There is a large literature on methods for estimating average treatment effects under
the assumption of unconfoundedness (also referred to as selection-on-observables, exogeneity, ignorability, or simply the conditional independence assumption). Under this
assumption the comparison of units with different treatments but identical pretreatment
variables can be given a causal interpretation. Much of the econometric literature has
focused on establishing asymptotic properties for a variety of estimators, without a firm
conclusion on the relative merits of these estimators. As a result, the theoretical literature
leaves the empirical researcher with a bewildering choice of methods, with limited, and
often conflicting guidance on what to use in practice. Possibly in response to that, and
possibly also because of lack of compelling evidence that simple methods (e.g., ordinary
least squares regression) are not adequate, few of the estimators proposed in the recent
literature have been widely adopted. Instead researchers continue to use ordinary linear
regression methods with an indicator for the treatment and other covariates entering
additively and linearly. However, such simple methods do not always work well. If the
covariate distributions differ substantially by treatment status, conventional regression
methods can be sensitive to minor changes in the specification because of their heavy
reliance on extrapolation.
In this paper I provide some advice for researchers estimating average treatment effects in practice, based on my personal view of this literature. The issues raised in this
paper build on my earlier reviews (Imbens, 2004; Imbens and Wooldridge, 2009), and
on my forthcoming book with Rubin (Imbens and Rubin, 2014). I focus on four specific issues. First, I discuss when and why the simple ordinary least squares estimator,
which ultimately relies on the same fundamental unconfoundedness assumption as matching and propensity score estimators, but which combines that assumption with strong
functional form restrictions, is likely to be inadequate for estimating average treatment
effects. Second, I discuss in detail two specific, fully specified, estimators that in my
view are attractive alternatives to least squares estimators because of their robustness

[1]

properties with respect to a variety of data configurations. Although I describe these
two methods in some detail, the message is emphatically not that these are the only
two estimators that are reasonably. Rather, the point is that unless a particular estimator is robust to modest changes in the implementation, any results should be viewed
with suspicion. Third, I discuss trimming and other preprocessing methods for creating
more balanced samples as an important first step in the analysis to ensure that the final
results are more robust with any estimators, including least squares, weighting, or matching. Fourth, I discuss some supplementary analyses for assessing the plausibility of the
unconfoundedness assumption. Although unconfoundedness is not testable, one should
assess, whenever possible, whether unconfoundedness is plausible in specific applications,
and in many cases one can in fact do so.
I illustrate the methods discussed in this paper using three different data sets. The
first of these is a subset of the lottery data collected by Imbens, Rubin and Sacerdote
(2001). The second data set is the experimental part of the Dehejia and Wahba (1999)
version of the Lalonde (1986) data set containing information on participants in the Nationally Supported Work (NSW) program and members of the randomized control group.
The third data set contains information on participants in the NSW program and one
of Lalonde’s non-experimental comparison groups. Both subsets of the Dehejia-Wahba
version of the Lalonde data are available on Dehejia’s website, http://users.nber.org/ rdehejia/. Software for implementing these methods will be available on my website.

2

Set Up and Notation

The set up used in the current paper is by now the standard one in this literature, using
the potential outcome framework for causal inference that builds on Fisher (1925) and
Neyman (1923) and was extended to observational studies by Rubin (1974). See Imbens
and Wooldridge (2009) for a recent survey and historical context. Following Holland
(1986), I will refer to this set up as the Rubin Causal Model, RCM for short.1
1

There is some controversy around this terminology. In a personal communication Holland told me
that he felt that Rubin’s generalizations of the earlier work (e.g., Neyman, 1923) and the central role

[2]

The analysis is based on a sample of N units, indexed by i = 1, . . . , N, viewed as a
random sample from an infinitely large population.2 For unit i there are two potential
outcomes, denoted by Yi (0) and Yi (1), the potential outcomes without and given the
treatment respectively. Each unit in the sample is observed to receive or not receive a
binary treatment, with the treatment indicator denoted by Wi . If unit i receives the
P
treatment then Wi = 1, otherwise Wi = 0. There are Nc = N
i=1 (1 − Wi ) control units
PN
and Nt = i=1 Wi treated units, so that N = Nc + Nt is the total number of units. The
realized (and observed) outcome for unit i is

Yi (0)
if Wi = 0,
obs
Yi = Yi (Wi ) =
Yi (1)
if Wi = 1.

I use the superscript “obs” here to distinguish between the potential outcomes which are
not always observed, and the observed outcome. In addition there is for each unit i a Kcomponent covariate Xi , with Xi ∈ X ⊂ RK . The key characteristic of these covariates
is that they are known not to be affected by the treatment. We observe, for all units in
the sample, the triple (Yiobs, Wi , Xi ). We use Y, W, and X to denote the vectors with
tyical elements Yiobs and Wi , and the matrix with i-th row equal to Xi0 .
Define the population average treatment effect conditional on the covariates,
τ (x) = E[Yi (1) − Yi (0)|Xi = x],
and the average effect in the population, and in the subpopulation of treated units,
τ = E [Yi (1) − Yi (0)] ,

and τtreat = E [ Yi (1) − Yi (0)| Wi = 1] .

(2.1)

There is a somewhat subtle issue that we can also focus on the average treatment effects
conditional on the covariates in the sample,
τsample

N
1 X
=
τ (Xi ),
N i=1

and τtreat,sample =

1 X
τ (Xi ).
Nt i:W =1

(2.2)

i

the potential outcomes play in his (Rubin’s) approach merited the label.
2
The assumption that the sample can be viewed as a random sample from a large population is
largely for convenience. Abadie, Athey, Imbens and Wooldridge (2014) discuss the implications of this
assumption, as well as alternatives.

[3]

This matters for inference, although not for estimation. The asymptotic variances for
the same estimators, viewed as estimators of τsample and τtreat,sample are generally smaller
than when we view τ and τtreat as the target, unless there is no variation in τ (x) over
the population distribution of Xi . See Imbens and Wooldridge (2009) for more details
on this distinction.
The first key assumptions we make is unconfoundedness (Rubin, 1990),
Wi ⊥
⊥




Yi (0), Yi (1)

Xi ,

(2.3)

where, using the Dawid (1979) conditional independence notation, A ⊥
⊥ B|C denotes
that A and B are independent conditional on C. The second key assumption is overlap,
0 < e(x) < 1,

(2.4)

for all x in the support of the covariates, where
e(x) = E[Wi |Xi = x] = Pr(Wi = 1|Xi = x),

(2.5)

is the propensity score (Rosenbaum and Rubin, 1983). The combination of these two
assumptions is referred to as strong ignorability by Rosenbaum and Rubin (1983). The
combination implies that we can estimate the average effects by adjusting for difference in
covariates between treated and control units. For example, given unconfoundedness, the
population average treatment effect τ can be expressed in terms of the joint distribution
of (Yiobs, Wi , Xi ) as
h 

 obs
i
obs
τ = E E Yi
Wi = 1, Xi − E Yi
Wi = 0, Xi .

To see that (2.6) holds, note that by definition,

h 

 obs
i
obs
E E Yi
Wi = 1, Xi − E Yi
Wi = 0, Xi

h
i
= E E [ Yi (1)| Wi = 1, Xi ] − E [ Yi (0)| Wi = 0, Xi ] .

By unconfoundedness we can drop the conditioning on Wi in these two terms, and
h
i
E E [ Yi (1)| Wi = 1, Xi ] − E [ Yi (0)| Wi = 0, Xi ]
[4]

(2.6)

h
i
= E E [ Yi (1)| Xi ] − E [ Yi (0)| Xi ]
h
i
= E E [ Yi (1) − Yi (0)| Xi ] = τ,

thus proving (2.6).

To implement estimators based on this equality we also require that the conditional
expectations E[Yi (0)|Xi = x], E[Yi (1)|Xi = x] and e(x) are sufficiently smooth, that
is, sufficiently many times differentiable. See the technical papers in this literature,
referenced in Imbens and Wooldridge (2009) for details on the smoothness requirements.
The statistical challenge is now how to estimate objects such as
h 
i

 obs
obs
Wi = 1, Xi − E Yi
Wi = 0, Xi .
E E Yi

(2.7)

We would like to estimate (2.7) without relying on strong functional form assumptions
on the conditional distributions or conditional expectations. We would also like the
estimators to be robust to minor changes in the implementation of the estimator.
Whether these two assumptions are reasonable is often controversial. Violations of
the overlap assumptions are often easily detected. They motivate some of the design
issues, and often imply that the researcher should change the estimand from the overall
average treatment effect to an average for some subpopulation. See Crump, Hotz, Imbens
and Mitnik (2009) for more discussion. Potential violations of the unconfoundedness
assumption are more difficult to address. First, there are some methods for assessing the
plausibility of the assumption, see the discussion in Section 4.2. To make the assumption
plausible, it is important to have detailed information about the units on characteristics
that are associated both with the potential outcomes and the treatment indicator. It is
often particularly helpful to have lagged measures of the outcome, e.g., detailed labor
market histories in evaluations of labor market programs. At the same time, having
detailed information on the background of the units makes the statistical challenge of
adjusting for all these differences more challenging.
This set up has been studied extensively in the statistics and econometric literatures. For reviews and general discussions in the econometrics literature see Angrist and
[5]

Krueger (2000), Angrist and Pischke (2009), Caliendo (2006), Heckman and Vytlacil
(2007), Imbens (2004), Imbens and Wooldridge (2009), Caliendo and Kopeinig (2011),
Frölich (2004), Wooldridge (2002), and Lee (2005). For reviews in other areas in applied
statistics see Rosenbaum (1995, 2010), Morgan and Winship (2007), Guo and Fraser
(2010), and Murnane and Willett (2010). Much of the econometric literature is technical
in nature and has primarily focused on establishing first order large sample properties of
point and interval estimators using matching (Abadie and Imbens, 2006), non-parametric
regression methods (Frolich, 2000; Chen, Hong and Tarozzi, 2008; Hahn, 1998; Hahn and
Ridder, 2013), or weighting (Hirano, Imbens, and Ridder, 2003; Frölich, 2002). These
first order asymptotic properties are identical for a number of proposed methods, limiting
the usefulness of these results for choosing between these methods. In addition, comparisons between the various methods based on Monte Carlo evidence (e.g., Frölich, 2004;
Busso, DiNardo and McCrary, 2008; Lechner, 2012) are hampered by the dependence
of many of the proposed methods on tuning parameters (e.g., the bandwidth choices in
kernel regression, or on the number of terms or basis functions in sieve or series methods) for which rarely specific, data-dependent values are recommended, as well as by the
difficulty in agreeing on realistic designs in simulation studies.
In this paper I will discuss my recommendations for empirical practice based on my
reading of this literature. These recommendations are somewhat personal. In places
they are also somewhat vague. I will emphatically not argue that one particular estimator should always be used. Part of the message is that there are no, and will not be,
general results implying that in general some estimators are superior to all others. The
recommendations are more specific in other places, for example suggesting supplementary
analyses that indicate for some data sets that particular estimators will be sensitive to
minor changes in implementation, thus making them unattractive in those settings. The
hope is that these comments will be useful for empirical researchers. The recommendations will consist of a combination of particular estimators, supplementary analyses, and
changes in estimands when (2.7) is particularly difficult to estimate.

[6]

3

Least Squares Estimation: When and Why Does
it Not Work?

The most widely used method for estimating causal effects remains ordinary least squares
(ols) estimation. Ordinary least squares estimation relies on unconfoundedness in combination with functional form assumptions. Typically researchers make these functional
form assumptions for convenience, viewing them at best as approximations to the underlying functions. In this section I discuss merits and concerns with this method for
estimating causal effects as opposed to using it for prediction. The main point is that the
least squares functional form assumptions matter, and sometimes matter substantially.
Moreover, one can assess from the data whether this will be the case.
To illustrate these ideas I will use a subset of the data collected by Lalonde. The
treatment is participation in a labor market training program the National Supported
Work (NSW) program. Later I will look at other parts of the data set, but here I
focus on the non-experimental comparison between the trainees and a non-experimental
comparison group from the Panel Study of Income Dynamics (PSID). The outcome of
interest is an earnings variable, earn’78. I focus on a subset of the data with a single
covariate, earn’75. There are Nt = 185 men in the treatment group, and Nc = 2490
men in the control group. From the experimental data it can be inferred that the average
causal effect is approximately $2000. Figures 1 and 2 present histograms of earn’75 in
the control and treatment group respectively. The average values of this variable in the
two groups are 19.1 and 1.5, with standard deviations 13.6 and 3.2 respectively. Clearly
the two distributions of earn’75 in the trainee and comparison groups are far apart.

3.1

Ordinary Least Squares Estimation

Initially I focus on the average effect for the treated, τtreat, defined in (2.1), although
the same issues arise for the average effect τ . Focusing on τtreat simplifies some of the
analytic calculations. Under unconfoundedness τtreat can be written as a function of the

[7]

joint distribution of (Yiobs, Wi , Xi ) as
τtreat = E
Define
obs

Yc

=



Yiobs

h 
i


obs
Wi = 1 − E E Yi
Wi = 0, Xi Wi = 1 .

1 X obs
Y ,
Nc i:W =0 i

obs

Yt

=

i

Xc =

(3.8)

1 X obs
Y
Nt i:W =1 i
i

1 X
Xi ,
Nc i:W =0

1 X
Xi .
Nt i:W =1

and X t =

i

i




Wi = 1 , is directly estimable from the data as Y t. It
i

Wi = 0, Xi Wi = 1 , that is more difficult to estimate.

Yiobs

The first term in (3.8), E
h 
is the second term, E E Yiobs

Suppose we specify a linear model for Yi (0) given Xi :
E[Yi (0)|Xi = x] = αc + βc · x.

The ols estimator for βc equal to
β̂c =

P

i:Wi =0 (Xi

obs

− X c ) · (Yiobs − Y c )

P

i:Wi =0 (Xi

− Xc

)2

,

obs

and α̂c = Y c − β̂c · X c .

For the Lalonde data we have
β̂c = 0.84 (s.e. 0.03),

α̂c = 5.60 (s.e. 0.51).

Then we can write the ols estimator of the average of the potential control outcomes for
the treated, E [ Yi (0)| Wi = 1], as

\
E [ Yi (0)|
Wi = 1] = Y c + β̂c · X t − X c ,

(3.9)

which for the Lalonde data leads to

\
E [ Yi (0)|
Wi = 1] = 6.88 (s.e. 0.48).
The question is how credible this is as an estimate of E [ Yi (0)| Wi = 1]. We focus on two
aspects of this credibility.
[8]

3.2

Extrapolation and Misspecification

First we need some additional notation. Let us denote the true conditional expectation
and variance of Yi (w) given Xi = x by
µw (x) = E[Yi (w)|Xi = x],

and σw2 (x) = V(Yi (w)|Xi = x).

Given the true conditional expectation the pseudo-true values for βc , the probability limit
of the ols estimator, is
βc∗ = plim(β̂c ) =

E[µc (Xi ) · (Xi − E[Xi ])|Wi = 0]
,
E[(Xi − E[Xi ])2|Wi = 0]

and the estimator for the predicted value for E[Yi (0)|Wi = 1] will converge to
\
plim(E [ Yi (0)|
Wi = 1]) = E[Yi (0)|Wi = 0] + βc∗ · (E[Xi |Wi = 1] − E[Xi |Wi = 0]) .


= E[Yi (0)|Wi = 1] − E[µt (Xi )|Wi = 1] − E[µt (Xi )|Wi = 0]


+βc∗ · E[Xi |Wi = 1] − E[Xi |Wi = 0] .

\
The difference between the plim(E [ Yi (0)|
Wi = 1]) and the true average E [ Yi (0)| Wi = 1]
depends on the difference between the average value of the regression function for the
treated and the controls and the approximation of this difference of the average conditional expectations by the difference in the average values of the best linear predictors,
\
plim(E [ Yi (0)|
Wi = 1]) − E [ Yi (0)| Wi = 1]

 

= βc∗ · E[Xi |Wi = 1] − E[Xi |Wi = 0] − E[µt (Xi )|Wi = 1] − E[µt(Xi )|Wi = 0] .

If the conditional expectations are truly linear, the difference is zero. In addition, if the
average covariate values in the two subpopulations have the same distribution, fX (x|Wi =
0) = fX (x|Wi = 1) for all x, the difference is zero. However, if both the conditional
expectations are nonlinear, and the covariate distributions differ, there will in general be
a bias. Establishing whether the conditional expectations are nonlinear can be difficult
to do. However, it is straightforward to assess whether the distributions of the covariates
in the two treatment arms are similar or not.
[9]

Now let us look at the sensitivity to different specifications. I consider two specification for the regression function. First, a simple linear regression:
earn078 = αc + βc · earn075 + εi

(linear).

Second, a linear regression after transforming the regressor by adding one unit (one
thousand dollars) followed by taking logarithms:
earn078 = αc + βc · ln (1 + earn075) + εi

(log linear).

The predictions for E [ Yi (0)| Wi = 1] based on the two models are quite different, given
that the average causal effect is on the order of two (thousand) dollars:
\
E [ Yi (0)|
Wi = 1]linear = 6.88 (s.e. 0.48)
\
Wi = 1]log
E [ Yi (0)|

linear

= 2.81 (s.e. 0.66).

The reason for the big difference (4.07) between the two predicted values can be seen in
Figure 3 where I plot the two estimated regression functions. The dashed vertical lines
present the 0.25 and 0.75 quartile of the distribution of earn075 for the PSID sample
(9.84 and 24.50 respectively). This indicates the range of values where the regression
function is most likely to approximate the conditional expectation accurately. The solid
vertical lines present the 0.25 and 0.75 quantiles for the distribution of earn075 for the
trainees (0 and 1.82 respectively). One can see in this figure that for the range where the
trainees are and where we therefore need to predict Yi (0), with earn075 between 0 and
1.82, the predictions of the linear and the log-linear model are quite different.
The estimates here were based on regression outcomes on earnings in 1975 for the
control units only. In practice an even more common approach is to simply estimate the
regression
earn078 = α + τ · Wi + β · earn075 + εi

(linear),

or
earn078 = α + τ · Wi + βc · ln (1 + earn075) + εi
[10]

(log linear),

on the full sample, including both treated and control units. The reason for focusing
on the regression in the control sample here is mainly expositional: it simplifies the
expressions for the estimated average of the potential outcomes. In practice it makes
relatively little difference if we do the regressions with both treated and control units
included. For these data, with many more control units (2490) than treated units (1985),
the estimates for the average of the potential outcome Yi (0) for the treated are, under the
linear and log linear model, largely driving by the values for the control units. Estimating
the regression function as a single regression on all units leads to:
\
E [ Yi (0)|
Wi = 1]linear, full
\
E [ Yi (0)|
Wi = 1]log

sample

= 6.93 (s.e. 0.47)

linear, full sample

= 3.47 (s.e. 0.38),

with the difference in the average predicted value for Yi (0) for the treated units between
the linear and the log linear specification much bigger than between the regression on
the control sample versus the regression on the full sample.

3.3

Weights

Here I present a different way of looking at the sensitivity of the least squares estimator
in settings with substantial differences in the covariates distributions. One can write the
ols estimator of E [ Yi (0)| Wi = 1] in a different way, as
1 X
\
E [ Yi (0)|
Wi = 1] =
ωi · Yiobs,
Nc i:W =0

(3.10)

i

where, for control unit i the weight ωi is

ωi = 1 − Xi − X c ·

Xc − Xt
.
X2 − X · X

(3.11)

It is interesting to explore the properties of these weights ωi . First, the weights average to
\
one over the control sample, irrespective of the data. Thus, E [ Yi (0)|
Wi = 1] is a weighted
average of the outcomes for the control units, with the weights adding up to one. Second,
the normalized weights ωi are all equal to 1 in the special case where the average of the
obs
\
covariates in the two groups are indentical. In that case E [ Yi (0)|
Wi = 1] = Y c . In a

[11]

randomized experiment X c is equal to X t in expectation, so the weights should be close
to 1 in that case. The variation in the weights, and the possibility of relatively extreme
weights, increases with the difference between X c and X t. Finally, note that given a
particular data set, one can inspect these weights directly, and assess if some units have
excessively large weights.
Let us first look at the normalized weights ωi for the Lalonde data. For these data
the weights take the form
ωi = 2.8091 − 0.0949 · Xi .
The average of the weights is, by construction, equal to 1. The standard deviation of
the weights is 1.29. The largest weight is 2.08, for control units with earn075 equal to
zero. It makes sense for control individuals with earn075 equal to zero to have substantial
weights, as there are many individuals in the treatment group with identical or similar
values for earn075. The most negative weight is for the control unit with earn075 equal to
156.7, with a weight of -12.05. This is where the problem with ordinary least squares regression shows itself most clearly. The range of values of earn075 for trainees is [0, 25.14].
I would argue that whether an individual with earn075 equal to 156.7 thousand dollars
makes $100,000 or $300,000 in 1978 should make no difference for a prediction for the
average value of Yi (0) for the trainees in the program, E [ Yi (0)| Wi = 1], given that the
maximum value for earn075 for trainees is 25.14. Conditional on the specification of the
linear model, however, that difference between $100,000 and $300,000 is very important
for the prediction of earnings in 1978 for trainees. Given the weight of −12.05 for the
control individual with earn075 equal to 156.7, the prediction for E [ Yi (0)| Wi = 1] would
be 6.829 if earn078 = 100 for this individual, and 5.861 if earn078 = 300 for this individual, with the difference equal to $968, a substantial amount. The problem is that the
least squares estimates take the linearity in the linear regression model very seriously,
and given linearity, observations on units with extreme values for earn075 are in fact very
informative. Note that one can carry out these calculations without even using the outcome data. It does not matter what the actual value is for earn078 for this unit, because
[12]

the weights is so large, the value of earn078 matters substantially for our prediction for
E [ Yi (0)| Wi = 1] where arguably it should have close to zero weight.

3.4

How to Think about Regression Adjustment

Of course the example in the previous subsection is fairly extreme. The two distributions are very different, with, for example, the fraction of the PSID control sample with
earn075 exceeding the maximum value found in the trainee sample (which is 25.14) equal
to 0.27. It would appear obvious that units with earn075 as large as 156.7 should be given
little or no weight in the analyses. An obvious remedy would be to discard all PSID units
with earn075 exceeding 25.14, and this would go a considerable way towards making the
estimators more robust. However, it is partly because there is only a single covariate
in this overly simplistic example that there are such simple remedies.3 With multiple
covariates it is difficult to see what trimming would need to be done. Moreover, a simple
trimming rule such as the one describe above is very sensitive to outliers. If there were a
single trainee with earn075 equal to 150, that would change the estimates substantially.
The issue is that regression methods are fundamentally not robust to the substantial
differences between treatment and control groups. I will be discussing alternatives to the
simple regression methods used here that do systematically, and automatically, downweight the influence of such outliers, both in the case with scalar covariates and in the
case with multivariate covariates. If, for example, instead of using regression methods,
one matched all the treated units, the control units with earn075 exceeding 25.07 would
receive zero weight in the estimation, and in fact few control units with earn075 between
18 and 25 would receive positive weights. Matching is therefore by design robust to the
presence of such units.
In practice it may be useful to compare the least squares estimates to estimates
based on more sophisticated methods, both as a check that calculations were carried out
correctly, and to ensure that one understands what is driving any difference between the
3

Note that Lalonde in his original paper does consider trimming the sample by dropping all individuals
with earnings in 1975 over some fixed threshold. He considers difference values for this threshold.

[13]

estimates.

4

The Strategy

In this section I lay out the overall strategy for flexibly and robustly estimating the
average effect of the treatment. The strategy will consist of two, sometimes three, distinct
stages. In the first stage, which I will refer to, following Rubin (2005), as the design
stage, the full sample will be trimmed by discarding some units to improve overlap
in covariate distributions. In the second stage, the supplementary analysis stage, the
unconfoundedness assumption is assessed. In the third stage, the analysis stage, the
estimator for the average effect will be applied to the trimmed data set. Let me briefly
discuss the three stages in more detail.

4.1

Stage I: Design

In this stage we do not use the outcome data and focus solely on the treatment indicators
and covariates, (X, W). The first step is to assess overlap in covariate distributions. If
this is found to be lacking, a subsample is created with more overlap by discarding some
units from the original sample. The assessment of the degree of overlap is based on
an inspection of some summary statistics, what I refer to as normalized differences in
covariates, denoted by ∆X . These are differences in average covariate values by treatment
status, scaled by a measure of the standard deviation of the covariates. These normalized
differences contrast with t-statistics for testing the null of no differences in means between
treated and controls. The normalized differences provide a scale and sample size free way
of assessing overlap.
If the covariates are far apart in terms of this normalized difference metric, one may
wish to change the target. Instead of focusing on the overall average treatment effect, one
may wish to drop units with values of the covariates such that they have no counterparts
in the other treatment group. The reason is that in general no estimation procedure
will be give robust estimates of the average treatment effect in that case. To be specific,

[14]

following Crump, Hotz, Imbens and Mitnik (2008a, CHIM from hereon), I propose a rule
for dropping units with extreme (that is, close to zero or one) values for the estimated
propensity score. This step will require estimating the propensity score ê(x : W, X).
One can capture the result of this first stage in terms of a function I = I(W, X), that
determines which units are dropped as a function of the vector of treatment indicators
W and the matrix of pretreatment variables X. Here I denotes an N vector of binary
indicators, with i-th element Ii equal to one if unit i is included in the analysis, and Ii
equal to zero if unit i is dropped. Dropping the units with Ii = 0 leads to a trimmed
P
sample (YT , WT , XT ) with Ns = N
i=1 Ii units.

4.2

Stage II: Supplementary Analysis: Assessing Unconfoundedness

In the second stage, analyses are carried out to assess the plausibility of unconfoundedness. Again it should be stressed that these analyses can be carried out without access
to the outcome data Y, using solely (W, X). Here the set of pretreatment variables or
covariates is partitioned into two parts, the first a vector of pseudo outcomes, Xp , and
the second a matrix containing the remaining covariates, Xr . We then take the pseudo
sample (Xp , W, Xr) and estimate the average effect of the treatment on this pseudo outcome, adjusting only for differences in the remaining covariates Xr . This will involve first
trimming this pseudo sample using the same procedures to construct a trimmed sample
(XTp , WT , XTr ), and then estimating a “pseudo” average treatment effect on the pseudo
outcome for this trimmed sample.
Specifically, I calculate
τ̂X = τ (XTp , WT , XTr ),
for specific estimators τ (·) described below, where the adjustment is only for the subset of
covariates included in XTr . This estimates the “pseudo” causal effect, the causal effect of
the treatment on the pretreatment variable Xp , which is a priori known to be zero. If we
find the estimate τ̂X is substantially and statistically close to zero, after adjusting for XTr ,
[15]

this will be interpreted as evidence supportive of the assumption of unconfoundedness. If
the estimate τ̂X differs from zero, either substantially or statistically, this will be viewed
as casting doubt on the (ultimately untestable) unconfoundedness assumption, with the
degree of evidence dependent on the magnitude of the deviations. The result of this stage
will therefore be an assessment of the credibility of any estimates of the average effect of
the treatment on the outcome of interest, without using the actual outcome data.

4.3

Stage III: Analysis

In the third stage the outcome data Y are used and estimates of the average treatment
effect of interest are calculated. Using one of the recommended estimators, blocking (subclassification) or matching, applied to the trimmed sample, we obtain a point estimate:
τ̂ = τ (YT , WT , XT ).
This step is more delicate, with concerns about pre-testing bias, and I therefore propose
no specification searches at this stage. The first estimator I discuss in detail is based
on blocking or subclassification on the estimated propensity score in combination with
regression adjustments within the blocks. The second estimator is based on direct oneto-one (or one-to-k) covariate matching with replacement in combination with regression
adjustments within the matched pairs. Both are in my view attractive estimators because
of their robustness.

5

Tools

In this section I will describe the calculation of the normalized differences ∆X,k and the
four functions, the propensity score, e(x; W, X), the trimming function, I(W, X), the
blocking estimator, τblock(Y, W, X) and the matching estimator, τmatch (Y, W, X), and
the choices that go into these function.
I should note that in specific situations, one may augment the implicit choices made
regarding the specification of the regression function and the propensity score in the
proposed algorithm with substantive knowledge. Such knowledge is likely to improve the
[16]

performance of the methods. Such knowledge notwitstanding, there is often a part of the
specification about which the researcher is agnostic. For example, the researcher may
not have strong a priori views on whether a pretreatment variable such as age should
enter linearly or quadratically in the propensity score in the context of the evaluation of a
labor market program. The methods described here are intended to assist the researcher
in such decisions by providing a benchmark estimator for the average effect of interest.

5.1

Assessing Overlap: Normalized Differences in Average Covariates

For element Xi,k of the covariate vector Xi the normalized difference is defined as
∆X,k = q

X t,k − X c,k
2
(SX,t,k

+

2
SX,c,k
)/2

,

(5.12)

where

X c,k =

1 X
Xi,k ,
Nc i:W =0

X t,k =

i

2
SX,c,k
=

1 X
Xi,k ,
Nt i:W =1
i

X
2
1
Xi,k − X c,k ,
Nc − 1 i:W =0

2
and SX,t,k
=

i

X
2
1
Xi,k − X t,k .
Nt − 1 i:W =1
i

A key point is that the normalized difference is more useful for assessing the magnitude of

the statistical challenge in adjusting for covariate differences between treated and control
units than the t-statistic for testing the null hypothesis that the two differences are zero,
or
tX,k = q

X t,k − X c,k
2
2
SX,t,k
/Nt + SX,c,k
/Nc

.

(5.13)

The t-statistic tX,k may be large in absolute value simply because the sample is large and,
as a result, small differences between the two sample means are statistically significant
even if they are substantively small. Large values for the normalized differences, in
contrast, indicate that the average covariate values in the two groups are substantially
different. Such differences imply that simple methods such as regression analysis will
be sensitive to specification choices and outliers. In that case there may in fact be no
estimation method that leads to robust estimates of the average treatment effect.
[17]

5.2

Estimating the Propensity Score

In this section I discuss an estimator for the propensity score e(x). The estimator is
based on a logistic regression model, estimated by maximum likelihood. Given a vector
of functions h : X 7→ RM , the propensity score is specified as
exp (h(x)0 γ)
e(x) =
,
1 + exp (h(x)0γ)
with an M-dimensional parameter vector γ. There is no particular reason for the choice
of a logistic model, as opposed to, say a probit model where e(x) = Φ(h(x)0 γ). This
is one of the places where it is important that the eventual estimates to be robust to
this choice. In particular the trimming of the sample will improve the robustness to this
choice, removing units with estimated propensity score values close to zero or one where
the choice between logit and probit models may matter.
Given a choice for the function h(x), the unknown parameter γ is estimated by maximum likelihood:
N n

o
X
γ̂ml (W, X) = arg max L(γ|W, X) = arg max
Wi ·h(Xi )0γ −ln 1+exp (h(Xi )0 γ) .
γ

λ

i=1

The estimated propensity score is then
ê(x|W, X) =

exp (h(x)0γ̂ml (W, X))
.
1 + exp (h(x)0 γ̂ml (W, X))

The key issue is the choice of the vector of functions h(·). First note that the propensity score plays a mechanical role in balancing the covariates. It is not given a structural
or causal interpretation in this analysis. In choosing a specification there is therefore
little role for theoretical substantive arguments: we are mainly looking for a specification
that leads to an accurate approximation to the conditional expectation. At most theory
may help in judging which of the covariate are likely to be important here.
A second point is that there is little harm in specification searches at this stage. The
inference for the estimators for the average treatment effect we consider is conditional on
covariates, and is not affected by specification searches at this stage which do not involve
the data on the outcome variables.
[18]

A third point is that although the penalty for including irrelevant terms in the propensity score is generally small, eventually the precision will go down if too many terms are
included in the specification.
A simple, and the most common choice for the specification of the propensity score
is to take the basic covariates themselves, h(x) = x. This need not be adequate for
two reasons. The main reason is that this specification may not be sufficiently flexible.
In many cases there are important interactions between the covariates that need to be
adjusted for in order to get an adequate approximation to the propensity score. Second,
it may be that the linear specification includes pretreatment variables that have very
little association with the treatment indicator and therefore need not be included in
the specification. Especially in settings with many pretreatment variables this may be
wasteful and lead to low precision in the final estimates. I therefore discuss a more flexible
specification for the propensity score based on stepwise regression, proposed in Imbens
and Rubin (2014). This provides a data driven way to select a subset of all linear and
second order terms. Details are provided in the Appendix. There are many, arguably
more sophisticated, alternatives to choose a specification for the propensity score, which,
however, have not been tried out much in practice. Other discussions include Millimet
and Tchernis (2009). Recently lasso methods have been proposed for similar problems
(Tibshirani, 1996). See Belloni, Chernozhukov and Hansen (2012) for applications to, and
extensions for, the current treatment-effect setting. However, the point is again not to
find a single method for estimating the propensity score that will out-perform all others.
Rather, the goal is to find a reasonable method for estimating the propensity score that
will, in combination with the subsequent adjustment methods, lead to estimates for the
treatment effects of interest that are similar to those based on other reasonable strategies
for estimating the propensity score. For the estimators here a finding that the final results
for say the average treatment effect are sensitive to using the stepwise selection method
compared to, say, the lasso or other shrinkage methods, would raise concerns that none
of the estimates are credible.
This vector of functions always includes a constant: h1 (x) = 1. Let us consider
[19]

the case where x is a a K-component vector of covariates (not counting the intercept),
I restrict the remaining elements of h(x) to be either equal to an component of x, or
to be equal to the product of two components of x. In this sense the estimator is
not fully nonparametric: although one can generally approximate any function by a
polynomial, here I limit the approximating functions to second order polynomials. In
practice, however, for the purposes I will use the estimated propensity score for, this
need not be a severe limitation.
The problem now is how to choose among the (K + 1)× (K + 2)/2− 1 first and second
order terms. I select a subset of these terms in a stepwise fashion. Three choices are to
be made by the researcher. First, there may be a subset of the covariates that will be
included in the linear part of the specification, irrespective of their association with the
outcome and the treatment indicator. Note that biases from omitting variables comes
from both the correlation between the omitted variables and the treatment indicator and
the correlation between the omitted variable and the outcome, just as in the conventional
omitted variable formula for regression. In applications to job training programs these
might include lagged outcomes, or other covariates that are a priori expected to be
substantially correlated with the outcomes of interest. Let us denote this subvector by
XB , with dimension 1 ≤ KB ≤ K + 1 (XB always includes the intercept). This vector
need not include any covariates beyond the intercept, if the researcher has no strong views
regarding the relative importance of any of the covariates. Second, a threshold value for
inclusion of linear terms has to be specified. The decision to include an additional linear
term is based on a likelihood ratio test statistic for the null hypothesis that the coefficient
on the additional covariate is equal to zero. The threshold value will be denoted by Clin,
with the value used in the applications is Clin = 1. Finally, a threshold value for inclusion
of second order terms has to be specified. Again the decision is based on the likelihood
ratio statistic for the test of the null hypothesis that the additional second order term has
a coefficient equal to zero. The threshold value will be denoted by Cqua, and the value
used in the applications in the current paper is Cqua = 2.71. The values for Clin and
Cqua have been tried out in simulations, but there are no formal results demonstrating
[20]

that these are superior to other values. More research regarding these choices would be
useful.

5.3

Blocking with Regression

The first estimator relies on an initial estimate of the propensity score and uses subclassification (Rosenbaum and Rubin, 1983, 1984), combined with regression within the
subclasses. Conceptually there are a couple of advantages of this estimator over simple
weighting estimators. First, the subclassification approximately averages the propensity
score within the subclasses, and so smoothes over the extreme values of the propensity
score. Second, the regression within the subclasses adds a lot of flexibility compared to
a single weighted regression.
I use the estimator for the propensity score discussed in the previous section. The
estimator then requires partitioning of the range of the propensity score, the interval
[0, 1] into J intervals of the form [bj−1, bj ), for j = 1, . . . , J , where b0 = 0 and bJ = 1. Let
Bi (j) ∈ {0, 1} be a binary indicator for the event that the estimated propensity score
for unit i, ê(Xi ), satisfies bj−1 < ê(Xi ) ≤ bj . Within each block the average treatment
effect is estimated using linear regression with some of the covariates, and including an
indicator for the treatment:




α̂j , τ̂j , β̂j = arg min
α,τ,β

N
X

2

Bi (j) · (Yi − α − τ · Wi − β 0Xi ) .

i=1

The covariates included beyond the intercept may consist of all, or a subset of the covariates viewed as most important. Because the covariates are approximately balanced
within the blocks, the regression does not rely heavily on extrapolation as it might do if
applied to the full sample. This leads to J estimates τ̂j , one for each stratum or block.
These J within-block estimates τ̂j are then averaged over the J blocks, using either the
proportion of units in each block, (Ncj + Ntj )/N, or the proportion of treated units in
each block, Ntj /Nt as the weights:
τblock(Y, W, X) =

J
X
Ncj + Ntj
j=1

N

· τ̂j ,

and τblock,treat(Y, W, X) =

J
X
Ntj
j=1

[21]

Nt

· τ̂j . (5.14)

The only decision the researcher has to make in order to implement this estimator is
the number of blocks, J , and boundary values for the blocks, bj , for j = 1, . . . , J − 1.
Following analytic result by Cochran (1968) for the case with a single normally distributed
covariate, researchers have often used five blocks, with an equal number of units in each
block. Here I use a data-dependent procedure for selecting both the number of blocks
and their boundaries, that leads to a number of blocks that increases with the sample
size, developed in Imbens and Rubin (2014).
The algorithm relies on comparing average values of the log odds ratios by treatment
status, where the estimated log odds ratio is


ê(x)
ˆ
`(x) = ln
.
1 − ê(x)
Start with a single block, J = 1. Check whether the current stratification or blocking
is adequate. This check is based on the comparison of three statistics, one regarding
the correlation of the log odds ratio with the treatment indicator within the current
blocks, and two concerning the block sizes if one were to split them further. Calculate
the t-statistic for the test of the null hypothesis that the average value for the estimated
propensity score for the treated units is the same as the average value for the estimated
propensity score for the control units in the block. Specifically, if one looks at block j,
with Bij = 1 if unit i is in block j (or bj−1 ≤ ê(Xi ) < bj ), the t-statistic is
`ˆtj − `ˆcj
t= q
,
2
2
S`,j,t
/Ntj + S`,j,c
/Ncj

where

N
1 X
ˆ
ˆ i ),
`cj =
(1 − Wi ) · Bi (j) · `(X
Ncj i=1
2
S`cj

and

N
1 X
ˆ
ˆ i ),
`tj =
Wi · Bi (j) · `(X
Ntj i=1

N

2
X
1
ˆ i ) − `ˆcj ,
=
(1 − Wi ) · Bij · `(X
Ncj − 1 i=1
N

2
S`tj
=


2
X
1
ˆ i ) − `ˆtj .
Wi · Bi (j) · `(X
Ntj − 1 i=1
[22]

If the block were to be split, it would be split at the median of the values of the estimated
propensity score within the block (or at the median value of the estimated propensity
score among the treated if the focus is on the average value for the treated). For block
j, denote this median by bj−1,j , and define
N−,c,j =

X

1bj−1 ≤ê(Xi )<bj−1,j ,

X

1bj−1,j ≤ê(Xi )<bj

N−,t,j =

i:Wi =0

N+,c,j =

X

1bj−1 ≤ê(Xi)<bj−1,j ,

i:Wi =1

and N+,t,j =

i:Wi =0

X

1bj−1,j ≤ê(Xi )<bj .

i:Wi =1

The current block will be viewed as adequate if either the t-statistic is sufficiently small
(less than tmax
block), or if splitting the block would lead to too small a number of units in
one of the treatment arms or in one of the new blocks. Formally, the current block will
be viewed as adequate if either,

t ≤ tmax
block = 1.96,
or
min (N−,c,j , N−,t,j , N+,c,j , N+,t,j ) ≤ 3,
or
min (N−,c,j + N−,t,j , N+,c,j + N+,t,j ) ≤ K + 2,
where K is the number of covariates. If all the current blocks are deemed adequate the
blocking algorithm is finished. If at least one of the blocks is viewed as not adequate, it
is split by the median (or at the median value of the estimated propensity score among
the treated if the focus is on the average value for the treated). For the new set of blocks
the adequacy is calculated for each block, and this procedure continues until all blocks
are viewed as adequate.

[23]

5.4

Matching with Replacement and Bias-Adjustment

In this section I discuss the second general estimation procedure, matching. For general
discussions of matching methods see Rosenbaum (1989), Rubin (1973a, 1979), Rubin
and Thomas (1992ab), Sekhon (2009), and Hainmueller (2012). Here I discuss a specific
procedure developed by Abadie and Imbens (2006).4 This estimator consists of two steps.
First all units are matched, both treated and controls. The matching is with replacement,
so the order in which the units are matched does not matter. After matching all units,
or all treated units if the focus is on the average effect for the treated, some of the
remaining bias is removed through regression on a subset of the covariates, with the
subvector denoted by Zi .
For ease of exposition we focus on the case with a single match. The methods generalize in a straightforward manner to the case with multiple matches. See Abadie and
Imbens (2006) for details. Let the distance between two values of the covariate vector x
0
and x0 be based on the Mahalanobis metric: kx, x0k = (x − x0 )0Ω̂−1
X (x − x ), where Ω̂X is

the sample covariance matrix of the covariates. Now for each i, for i = 1, . . . , N, let `(i)
be the index for the closest match, defined as
`(i) = arg min kXi − Xj k,
j:Wj 6=Wi

where we ignore the possibility of ties. Given the `(i) define
 obs

Yi
if Wi = 0,
Y`(i) ,
Ŷi (1) =
Ŷi (0) =
obs
Y`(i)
if Wi = 1,
Yiobs
Define also the matched values for the covariates:


Xi
if Wi = 0,
X`(i) ,
X̂i (0) =
X̂i (1) =
X`(i) ,
if Wi = 1,
Xi

if Wi = 0,
if Wi = 1.

if Wi = 0,
if Wi = 1.

This leads to a matched sample, with N pairs. Note that the same units may be used
as a match more than once, because we match with replacement. The simple matching
PN
estimator discussed in Abadie and Imbens (2006) is τ̂sm = i=1 (Ŷi (1) − Ŷi (0))/N. Abadie
4

The estimator has been implemented in the official version of Stata. See also Abadie, Drukker, Herr,
and Imbens (2003), and Becker and Ichino (2002).

[24]

and Imbens (2006, 2010) suggest improving the bias properties of this simple matching
estimator by using linear regression to remove biases associated with differences between
X̂i (0) and X̂i (1). See also Quade (1982) and Rubin (1973b). First run the two least
squares regressions
Ŷi (0) = αc + βc0 X̂i (0) + εci ,

and Ŷi (1) = αt + βt0X̂i (1) + εti ,

in both cases on N units, to get the least squares estimates β̂c and β̂t . Now adjust the
imputed potential outcomes as
( obs
Yi


Ŷiadj(0) =
Ŷi (0) + β̂c0 X̂i (1) − X̂i (0) ,

if Wi = 0,
if Wi = 1,

and

Ŷiadj(1)

=

(



Ŷi (1) + β̂t0 X̂i (0) − X̂i (1) ,

Yiobs

Now the bias-adjusted matching estimator is
N

1 X adj
τmatch =
Ŷi (1) − Ŷiadj(0) ,
N i=1

if Wi = 0,
if Wi = 1,

(5.15)

and the bias-adjusted matching estimator for the average effect for the treated is

1 X  adj
τmatch =
Ŷi (1) − Ŷiadj(0) .
(5.16)
Nt i:W =1
i

In practice the linear regression bias-adjustment eliminates a large part of the bias that
remains after the simple matching. Note that the linear regression used here is very
different from linear regression in the full sample. Because the matching ensures that
the covariates are well-balanced in the matched sample, linear regression does not rely
much on extrapolation the way it may in the full sample if the covariate distributions
are substantially different.

5.5

A General Variance Estimator

In this section I will discuss an estimator for the variance of the two estimators for average
treatment effects. Note that the bootstrap is not valid in general because matching
estimators are not asymptotically linear. See Abadie and Imbens (2008) for detailed
discussions.
[25]

5.5.1

The Weighted Average Outcome Representation of Estimators, and
Asymptotic Linearity

The first key insight is that most estimators for average treatment effects share a common
structure. This common structure is useful for understanding some of the commonalities
of and differences between the estimators. These estimators, including the blocking and
matching estimators discussed in Sections 5.3 and 5.4, can be written as a weighted
average of observed outcomes,
τ̂ =

1 X
1 X
λi · Yiobs −
λi · Yiobs ,
Nt i:W =1
Nc i:W =0
i

(5.17)

i

with
1 X
λi = 1,
Nt i:W =1

and

i

1 X
λi = 1.
Nc i:W =0
i

Moreover, the weights λi do not depend on the outcomes Yobs , only on the covariates
X and the treatment indicators W. The specific functional form of the dependence
of the weights λi on the covariates and treatment indicators depends on the particular
estimator, whether linear regression, matching, weighting, blocking, or some combination
thereof. Given the choice of the estimator, and given values for W and X, the weights
can be calculated. See Appendix B for the results for some common estimators.
5.5.2

The Conditional Variance

Here we focus on estimation of the variance of estimators for average treatment effects,
conditional on the covariates X and the treatment indicators W. We exploit the weighted
linear average characterization of the estimators in (5.17) Hence the conditional variance
is
V (τ̂|X, W) =

N 
X
Wi
i=1

1 − Wi
+
2
Nt
Nc2



2
· λ2i · σW
(Xi ).
i

2
The only unknown components of this variance is σW
(Xi ). Rather than estimating these
i

conditional variances through nonparametric regression, following Abadie and Imbens
(2006) I suggest using matching. Suppose unit i is a treated unit. Then find closest
[26]

match within the set of all other treated units in terms of the covariates. Ignoring ties,
let h(i) be the index of the unit with the same treatment indicator as i, closest to Xi :
h(i) = arg

min

j=1,...,N,j6=i,Wj =Wi

kXi − Xj k.

Because Xi ≈ Xh(i) , and thus µ1 (Xi ) ≈ µ1 (Xh(i) ), it follows that we can approximate the
difference Yi − Yh(i) by

 

Yi − Yh(i) ≈ Yi (1) − µ1 (Xi ) + Yh(i) (1) − µ1 (Xh(i) ) .

(5.18)

The right hand side of (5.18) has expectation zero and variance equal to σ12(Xi ) +
2
σ12 (Xh(i) ) ≈ 2σ12 (Xi ). This motivates estimating σW
(Xi ) by
i
2
σ̂W
(Xi ) =
i


1 obs
obs 2
Yi − Yh(i)
.
2

2
2
Note that this estimator σ̂W
(Xi ) is not a consistent estimator for σW
(Xi ). However,
i
i

this is not important, because we are interested not in the variances at specific points
in the covariates distribution, but rather in the variance of the average treatment effect.
Following the procedure introduce above, this variance is estimated as:
V̂ (τ̂|X, W) =

N 
X
Wi
i=1

1 − Wi
+
Nt2
Nc2



2
· λ2i · σ̂W
(Xi ).
i

In principle one can generalize this variance estimator using the nearest L matches rather
than just using a single match. In practice there is little evidence that this would make
much of a difference. Hanson and Sunderam (2012) discuss extensions to clustered sampling.

5.6

Design: Ensuring Overlap

In this section I discuss two methods for constructing a subsample of the original data
set that is more balanced in the covariates. Both take as input the vector of assignments
W and the matrix of covariates X, and select a set of units, a subset of the set of indices
{1, 2, . . . , N}, with N T elements, leading to a trimmed sample with assignment vector
WT , covariates XT , and outcomes YT . The units corresponding to these indices will
[27]

then be used to apply the estimators for average treatment effects discussed in Sections
5.3 and 5.4.
The first method is aimed at settings with a large number of controls relative to
the number of treated units, and the focus is on the average effect of the treated. This
method constructs a matched sample where each treated unit is matched to a distinct
control unit. This creates a sample of size 2 · Nt distinct units, half of them treated and
half of them control units. This sample can then be used in the analyses of Sections 5.3
and 5.4.
The second method for creating a sample with overlap drops units with extreme
values of the propensity score. For such units it is difficult to find comparable units with
the opposite treatment. Their presence makes analyses sensitive to minor changes in the
specification to the presence of outliers in terms of outcome values. In addition their
presence increases the variance of many of the estimators. The threshold at which units
are dropped is based on a variance criterion, following CHIM.
5.6.1

Matching Without Replacement On the Propensity Score to Create a
Balanced Sample

The first methods creates balance by matching on the propensity score. Here we match
without replacement. Starting with the full sample with N units, Nt treated and Nc > Nt
controls, the first step is to estimate the propensity score using the methods from Section
5.2. We then transform this to the log odds ratio,


ê(x; W, X)
ˆ
`(x; W, X) = ln
.
1 − ê(x; W, X)
To simplify notation I will drop the dependence of the estimated log odds ratio on X and
ˆ
W and simply write `(x).
Given the estimated log odds ratio, the Nt treated observations
are ordered, with the treated unit with the highest value of the estimated log odds ratio
score first. Then, the first treated unit (the one with the highest value of the estimated
log odds ratio), is matched with the control unit with the closest value of the estimated
log odds ratio.

[28]

ˆ i ) ≥ `(X
ˆ i+1 ), the
Formally, if the treated units are indexed by i = 1, . . . , Nt, with `(X
index of the matched control j(1) satisfies Wj(1) = 0, and
ˆ i ) − `(X
ˆ 1) .
j(1) = arg min `(X
i:Wi =0

Next, the second treated unit is matched to unit j(2), where Wj(2) = 0, and
j(2) = arg

min

i:Wi =0,i6=j(1)

ˆ i ) − `(X
ˆ 2) .
`(X

Continuing this for all Nt treated units leads to a sample of 2 · Nt distinct units, half of
them treated and half of them controls. Although before the matching the average value
of the propensity score among the treated units must be at least as large as the average
value of the propensity score among the control units, this need not be the case for the
matched samples.
I do not recommend simply estimating the average treatment effect for the treated by
differencing average outcomes in the two treatment groups in this sample. Rather, this
sample is used as a trimmed sample, with possibly still a fair amount of bias remaining,
but one that is more balanced in the covariates than the original full sample, and as a
result more likely to lead to credible and robust estimates. One may augment this procedure by dropping units for whom the match quality is particularly poor, say dropping
units where the absolute value of the difference in the log odds ratio between the unit
and its match is larger than some threshold.
5.6.2

Dropping Observations with Extreme Values of the Propensity Score

The second method for addressing lack of overlap we discuss is based on the work by
CHIM. Their starting point is the definition of average treatment effects for subsets of the
covariate space. Let X be the covariate space, and A ⊂ X be some subset of the covariate
space. Then define τ (A) = E[Yi (1) − Yi (0)|Xi ∈ A]. The idea in CHIM is to choose a set
A such that there is substantial overlap between the covariate distributions for treated
and control units within this subset of the covariate space. That is, we wish to exclude
from the set A, values for the covariates for which there are few treated units compared
[29]

the number of control units or vice versa. The question is how to operationalize this.
CHIM suggest looking at the asymptotic efficiency bound for the efficient estimator for
τ (A). The motivation for that criterion is as follows. If there is a value for the covariate
such that there are few treated units relative to the number of control units, then for
this value of the covariates the variance for an estimator for the average treatment effect
will be large. Excluding units with such covariate values should therefore improve the
asymptotic variance of the efficient estimator. It turns out that this is a feasible criterion
that leads to a relatively simple rule for trimming the sample. The trimming also improves
the robustness properties of the estimators. The trimmed units tend to be units with
high leverage whose presence makes estimators sensitive to outliers in terms of outcome
values.
CHIM calculate the efficiency bound for τ (A), building on the work by Hahn (1998),
assuming homoskedasticity so that σ 2 = σ02(x) = σ12 (x) for all x, and a constant treatment
effect, as


σ2
1
1
·E
+
X∈A ,
q(A)
e(X) 1 − e(X)
where q(A) = Pr(X ∈ A). They derive the characterization for the set A that minimizes
the asymptotic variance and show that it has the simple form
A∗ = {x ∈ X|α ≤ e(X) ≤ 1 − α},

(5.19)

where α satisfies


1
1
1
1
= 2·E
≤
.
α · (1 − α)
e(X) · (1 − e(X)) e(X) · (1 − e(X))
α · (1 − α)

Crump et al then suggest dropping units with Xi ∈
/ A∗ . Note that this subsample is
selected solely on the basis of the joint distribution of the treatment indicators and the
covariates, and therefore does not introduce biases associated with selection based on the
outcomes.
Implementing the CHIM suggestion is straightforward once one has estimated the
propensity score. Define the function g : X 7→ R, with
g(x) =

1
,
ê(x) · (1 − ê(x))
[30]

and the function h : R 7→ R, with
h(λ) = P
N

i=1

1
1{g(Xi )≤λ}

2

N
X

1{g(Xi )≤λ} · g(Xi ),

i=1

and let λ̂ = arg minλ h(λ). The value of α in (5.19) that defines A∗ is α̂ = 1/2 −
q
1/4 − λ̂/2. Finding λ̂ is straightforward. The function h(λ) is a step function so one

can simply evaluate the function at λ = g(Xi ) for i = 1, . . . , N and select the one that
minimizes h(λ).

The simulations reported in CHIM suggest that in many settings in practice the choice
α = 0.1, leading to
Ã = {x ∈ X|0.1 ≤ e(X) ≤ 0.9},
provides a good approximation to the optimal A∗.

5.7

Assessing Unconfoundedness

Although the unconfoundedness assumption is not testable, the researcher can often
do calculations to assess the plausibility of this critical assumption. These calculations
focus on estimating the causal effect of the treatment on a pseudo outcome, a variable
known to be unaffected by it, typically because its value is determined prior to the
treatment itself. Such a variable can be time-invariant, but the most interesting case is in
considering the treatment effect on a lagged outcome, commonly observed in evaluations
of labor market programs. If the estimated effect differs from zero, it is less plausible
that the unconfoundedness assumption holds, and if the treatment effect on the pseudo
outcome is estimated to be close to zero, it is more plausible that the unconfoundedness
assumption holds. Of course this does not directly test this assumption; in this setting,
being able to reject the null of no effect does not directly reflect on the hypothesis of
interest, unconfoundedness. Nevertheless, if the variables used in this proxy test are
closely related to the outcome of interest, the test arguably has more power. For these
tests it is clearly helpful to have a number of lagged outcomes.
[31]

To formalize this, let us suppose the covariates consist of a number of lagged outcomes
Yi,−1 , . . . , Yi,−T as well as time-invariant individual characteristics Zi , so that the full set
of covariates is Xi = (Yi,−1 , . . . , Yi,−T , Zi ). By construction only units in the treatment
group after period −1 receive the treatment; all other observed outcomes are control
outcomes. Also suppose that the two potential outcomes Yi (0) and Yi (1) correspond
to outcomes in period zero. Now consider the following two assumptions. The first is
unconfoundedness given only T − 1 lags of the outcome:
Yi (1), Yi (0) ⊥
⊥ Wi

Yi,−1 , . . . , Yi,−(T −1) , Zi ,

and the second assumes stationarity and exchangeability:
fYi,s (0)|Yi,s−1 (0),...,Yi,s−(T −1) (0),Zi,Wi (ys |ys−1 , . . . , ys−(T −1), z, w), does not depend on i and s.
Then it follows that
Yi,−1 ⊥
⊥ Wi

Yi,−2 , . . . , Yi,−T , Zi ,

which is testable. This hypothesis is what the procedure described above assesses, by analyzing the data with Xp = Y−1 and Xr = (Y−2 , . . . , Y−T , Z). Whether this test has much
bearing on unconfoundedness depends on the link between the two assumptions and the
original unconfoundedness assumption. With a sufficient number of lags unconfoundedness given all lags except the very last one would appear to be a plausible assumption
if unconfoundedness given all lags holds. Therefore the relevance of the test depends
largely on the plausibility of the second assumption, stationarity and exchangeability.

6

Three Applications

In this section I will apply the methods discussed in the previous sections to three data
sets. The first data set, the “lottery data”, collected by Imbens, Rubin and Sacerdote
(2001), contains information on individuals who won large prizes in the Massachusetts
lottery, as well as on individuals who won small one-time prizes. They study the effect
of lottery winnings on labor market outcomes. Here I look at the effect of winning a
[32]

large prize on average difference in labor earnings for the first six years after winning the
lottery. The second illustration is based a widely used data set, the “experimental Lalonde
data”, originally collected and analyzed by Lalonde (1986). Labor market programs are
a major area of application for the evaluation methods discussed here in this manuscript,
with important applications in Ashenfelter and Card (1985), Lalonde (1986), and Card
and Sullivan (1988). Here I use the version of the data put together by Dehejia and
Wahba (1999), and which is available from Dehejia’s website.5 The data set contains
information on men participating in an experimental job training program. The focus
is on estimating the average effect of the program on subsequent earnings. The third
data set, the “non-experimental Lalonde data”, replaces the individuals in the control
group of the experimental Lalonde data set with observations on men from the Current
Population Survey (CPS). It is also available on Dehejia’s website. The individuals in
the CPS are substantially different from those in the experiment, which creates severe
challenges for comparisons between the two groups.

6.1

The Imbens-Rubin-Sacerdote Lottery Data

We use a subset of 496 lottery players with complete information on key variables. Of
these 496 individuals 237 won big prizes (on average approximately $50,000 per year, for
twenty years), and 259 did not. For clarity we refer to the former group as the “winners”
and the latter as the “losers,” although the latter did win small one-time prizes. We
have information on them concerning their characteristics and economic circumstances
at the time of playing the lottery, and social security earnings for six years before and
after playing the lottery. Although obviously lottery numbers are drawn randomly to
determine the winners, within the subset of individuals who responded to our survey
(approximately 50%) there may be systematic differences between individuals who won
big prizes and individuals who did not. Moreover, even if there was no non-response,
differential ticket buying behavior implies that simple comparisons between winners and
non-winners do not necessarily have a causal interpretation.
5

The webpage is http://www.nber.org/˜rdehejia/nswdata.html.

[33]

6.1.1

Summary Statistics for the Imbens-Rubin-Sacerdote Data

Table 1 presents summary statistics for the covariates, including the normalized difference. The normalized differences are generally modest, with only three out of eighteen normalized differences larger than 0.30 in absolute value. These three are Tickets
Bought (the number of tickets bought per week), Age, and Years of Schooling. The
latter two may be related to the willingness to respond to the survey. Note that the
overall response rate in the survey was approximately 50%.
6.1.2

Estimating the Propensity Score for the Imbens-Rubin-Sacerdote Data

Four covariates are selected for automatic inclusion in the propensity score, Tickets
Bought, Years of Schooling, Working Then, and Earnings Year -1. The reason for
including Tickets Bought is that by the nature of the lottery, individuals buying more
tickets are more likely to be in the big winner sample, and therefore it is a priori known
that this variable should affect the propensity score. The other three covariates are
included because on a priori grounds they are viewed as likely to be associated with the
primary outcome, average yearly earnings for the six years after playing the lottery.
The algorithm discussed in detail in the Appendix leads to the inclusion of four
additional linear terms, and ten second order terms. The parameter estimates for the
final specification of the propensity score are presented in Table 2. The covariates are
listed in the order they were selected for inclusion in the specification. Note that only
one of the earnings measures was included beyond the (automatically selected) earnings
in the year immediately prior to playing the lottery.
To assess the sensitivity of the propensity score estimates to the selection procedure,
I consider three alternative specifications. In the second specification, I do not select any
covariates for automatic inclusion. In the third specification I include all linear terms, but
no second order terms. In the fourth specification I use lasso (Tibshirani, 1996) to select
among all first and second order terms for inclusion in the propensity score. In Table 3
I report the correlations between the log odds ratios (the logarithm of the ratio of the
propensity score and one minus the propensity score) based on these three specifications,
[34]

and the number of parameters estimated and the value of the log likelihood function.
It turns out in this particular data set, the automatic inclusion of the four covariates
does not affect the final specification of the propensity score. All four covariates are
included by the algorithm for choosing the specification of the propensity score even
if they had not be pre-selected. The fit of the propensity score model selected by the
algorithm is substantially better than that based on the specification with all eighteen
covariates included linearly with no second order terms or the lasso. Even though the
linear specification has the same degrees of freedom, it las a value of the log likelihood
function that is lower by 30.2. The lasso selects fewer terms, twelve in total, and also
has a substantially lower value for the log likelihood function.
6.1.3

Trimming the Imbens-Rubin-Sacerdote Data

In the lottery application the focus is on the overall average effect. I therefore use
the CHIM procedure discussed in Section 5.6.2 for trimming. The threshold for the
propensity score coming out of this procedure is 0.0891. This leads to dropping 86
individuals with an estimated propensity score less than 0.0891, and 87 individuals with
an estimated propensity score in excess of 0.9109. Table 4 presents details on the number
of units dropped by treatment status and value of the propensity score.
The trimming leaves us with a sample consisting of 323 individuals, 151 big winners
and 172 small winners. Table 5 presents summary statistics for this trimmed sample. One
can see that the normalized differences between the two treatment groups are substantially smaller. For example, in the full sample, the normalized difference in the number
of tickets bought was 0.90, and in the trimmed sample it is 0.51. I then re-estimate the
propensity score on the trimmed sample. The same four variables as before were selected
for automatic inclusion. Again four additional covariates were selected by the algorithm
for inclusion in the propensity score. These were the same four as in the full sample,
with the exception of male, which was replaced by pos earn year -5. For the trimmed
sample only four second order terms were selected by the algorithm. The parameter estimates for the propensity score estimated on the trimmed sample are presented in Table
[35]

6.
6.1.4

Assessing Unconfoundedness for the Imbens-Rubin-Sacerdote Data

Next I do some analyses to assess the plausibility of the unconfoundedness analyses.
There are eighteen covariates, six characteristics from the time of playing the lottery, six
annual earnings measures, and six indicators for positive earnings for those six years. I
use three different pseudo-outcomes. First I analyze the data using earnings from the the
last pre-winning year as the pseudo outcome, and second I use average earnings for the
last two pre-winning years as the pseudo outcome, and in the third case I use average
earnings for the last three pre-winning years as the pseudo outcome. In all three cases
I pre-select four covariates for automatic inclusion in the propensity score, the same
three characteristics as before with in each case the last pre-winning year of earnings
given the new outcome. I re-do the entire analyses, including estimating the propensity
score, trimming the sample and re-estimating the propensity score. Table 7 presents the
results for the blocking and matching estimators. In all three cases the both blocking
and matching estimates are substantively and statistically close to zero. The estimated
effects for the three pseudo outcomes range from -$1,160 to -$390, with none of the
three statistically significantly different from zero at the 10% level. This suggests that
unconfoundedness may be a reasonable assumption in this setting.
6.1.5

Estimating Average Treatment Effects for the Imbens-Rubin-Sacerdote
Data

Now we turn to the primary outcome, average earnings in the six years after playing the
lottery, the effect of winning a big prize. Note that up to now we had not used data
on the outcome in any of the analyses. I report eighteen estimates. One set of six uses
no covariates in the regression part, one set uses the four pre-selected covariates in the
regression part, and the final set of six uses all eighteen covariates in the regression part.
In each set of six estimates there are two based on the full sample (one blocking estimator
with a single block, and one matching estimator), and four based on the trimmed sample:
one with no blocking, one with two blocks, one with the optimal number of blocks, and one
[36]

matching estimator. The results are reported in Table 8. With five blocks the estimates
range from -$5,070 to -$5,740, with the standard errors between $1,400 to $2,000. With
two blocks the estimates are similar, with a little more variation. With no blocking the
estimates vary considerably more, and even more so in the full sample.
6.1.6

Sensitivity to the Specification of the Propensity Score for the ImbensRubin-Sacerdote Data

Finally we assess the sensitivity of the estimates of the average treatment effects to the
specification of the propensity score. We compare three specifications, one with CL = 1
and CQ = 2.71, which leads to the inclusion of some linear and some second order terms,
and the second corresponding to the inclusion of all linear terms and no second order
terms, which formally corresponds to CL = 0 and CQ = ∞, and in the third specification
we use the lasso to selection among all first and second order terms. In Table 9 we present
results for the same six estimators we considered before. The range of estimates for the
preferred (CL = 1, CQ = 2.71) specification is [−5.66, −4.19], with width 1.47. The
corresponding range for the linear propensity score estimator with (CL = 0, CQ = ∞)
specification is [−5.21, −2.39], with width 3.82. The lasso estimates range from −3.91 to
−2.97, somewhat lower than the other estimates.
6.1.7

Conclusions for the Imbens-Rubin-Sacerdote Data

Overall the analyses suggests that the blocking estimates are robust, with a preferred
estimate of the effect of winning a large prize on average yearly earnings around -$5,400,
and a standard error of about $1,400. Moreoever, the supporting analyses suggest that
this is credible as an estimate of the causal effect of winning the lottery.

6.2

The Lalonde Experimental Data (Dehejia-Wahba Sample)

The second data set comes from an experimental evaluation of a labor market training
program. It was originally analyzed by Lalonde (1986), and subsequently by many other
researchers. Various versions of the Lalonde data have been widely used in this literature
(Dehejia and Wahba, 1999; Heckman and Hotz, 1989; Smith and Todd, 2005; Crump,
[37]

Hotz, Imbens and Mitnik, 2008b). The data we use here were analyzed by Dehejia and
Wahba (1999) and are available on Dehejia’s website. The data set contains information
on 185 men who were randomly selected to the training program, and 260 men assigned
to the control group. We focus on estimating the average effect of the training.
6.2.1

Summary Statistics for the Experimental Lalonde Data

Table 10 presents summary statistics for the experimental Lalonde data. Not surprisingly
the normalized differences are modest. The largest is 0.30, for no degree. The t-statistic
for this covariate is 3.1. If we had all the data from the randomized experiment this
would be extremely unlikely, but given attrition it is not uncommon even in a randomized
experiment to find some covariates whose distributions differ in the two treatment groups.
6.2.2

Estimating the Propensity Score for the Experimental Lalonde Data

Next we estimate the propensity score. If we had data from a completely randomized
experiment with no attrition, the true propensity score would be constant. Even in that
case the algorithm might select some variables for inclusion in the propensity score and so
the estimated propensity score need not be constant. Here we include the four earnings
variables, earnings in 1974 and 1975, and indicators for these earnings being equal to
zero for inclusion into the propensity score. The algorithm selects three additional terms,
nodegree, hispanic, and education, for inclusion in the linar part of the propensity
score. In addition, the algorithm selects three second order terms, the interaction of
nodegree and education, earn ’74 and nodegree, and unempl ’75 and education,
for a total of eleven covariates. The results are in Table 11.
6.2.3

Trimming the Experimental Lalonde Data

Based on the estimated propensity score we discard individuals with very low and very
high values of the propensity score. The procedure described in Section 5.6.2 leads to a
threshold of 0.1299 for low values (and 0.8701 for high values). This leads to dropping
four control units with low values of the propensity score, and one treated unit with a

[38]

low value of the propensity score (0.12) and two treated units with a high value of the
propensity score. It should not come as a surprise that in this case the procedure does
not lead to a large number of units being dropped. The randomization ensures that
most units are comparable, and propensity score values are clustered around the average
value 0.42, with a standard deviation of 0.13. The minimum and maximum values for
the estimated propensity score are 0.03 and 0.91. Table 12 presents the subsample sizes.
We re-estimated the propensity score on the trimmed sample, but because the sample
is so similar to the full sample the algorithm selects the exact same specification and the
parameter estimates are very similar. For that reason they are not reported here.
6.2.4

Assessing Unconfoundedness for the Experimental Lalonde Data

The next step is to assess the unconfoundedness assumption. I use two pseudo outcomes.
The first is earn ’75, earnings in 1975, and the second is the average of earnings in
1974 and 1975. In the first case I use the eight covariates (the ten original ones minus
earnings in 1975 and the indicator for zero earnings in 1975), and in the second case I
use six covariates (the original ten minus the four earnings related covariates). In both
cases I do the full analysis, including trimming the sample and estimating the propensity
score. Table 14 presents the results for these analyses. I look at the subclassification
and matching estimators, using the all covariates to adjust for remaining bias. Over the
four cases (the two estimators and the two pseudo outcomes) the estimated effect of the
treatment on the pseudo outcome ranges from -$80 to $220. In none of the four cases can
we reject the null hypothesis of no effect of the treatment on the pseudo outcome (all four
t-statistics are less than or equal to 1 in absolute value). Thus, the data are supportive
of the unconfoundedness assumption, not surprisingly given that the data came from a
randomized experiment.
6.2.5

Subclasses for the Experimental Lalonde Data

To gain further understanding in the workings of these methods I report details on the
blocking procedure. The algorithm discussed in Section 5.3 and the Appendix leads for

[39]

the experimental Lalonde data to three blocks. Table 13 presents the block boundaries
and the number of control and treated units in each block. In the trimmed sample
the average estimated propensity for the treated individuals is 0.45 and for the control
individuals 0.39, with a difference of 0.06. Within each of the three blocks, however, the
difference in average propensity score values for treated and controls is 0.02 or less.
6.2.6

Estimating Average Treatment Effects for the Experimental Lalonde
Data

Finally we turn to the outcome data, earnings in 1978. In Table 15 I present results for
the blocking and matching estimators, using no covariates, the four earnings variables,
or all ten covariates for adjusting beyond the blocking or matching. The results range
from $1,460 to $2,300, in all cases significantly different from zero at the 5% level.
6.2.7

Conclusions for the Experimental Lalonde Data

For the experimental Lalonde data we find that the program had a positive effect on
earnings, with point estimates somewhere between $1,500 and $2,300. The variation
in the estimates is probably due to the small sample size and the thick-tailed earnings
distribution. The data suggest that unconfoundedness is plausible.

6.3

The Lalonde Non-experimental Data (Dehejia-Wahba Sample)

The final data set is the non-experimental Lalonde data. Here we take the men who were
assigned to the training program and compare them to a comparison group drawn from
the Current Population Survey. This is a data set that has been widely used as a testing
ground for estimators for treatment effects.
6.3.1

Summary Statistics for the Non-experimental Lalonde Data

Table 16 presents summary statistics for the covariates for the non-experimental Lalonde
data, including the normalized difference. Compared to the lottery data or the experimental Lalonde data we see substantially larger differences between the two groups, with
[40]

normalized differences as large as 2 (for the indicator for being African-American), and
many larger than 1 (including the a priori likely to be important earnings variables).
These summary statistics suggest that, irrespective of whether one believes the unconfoundedness assumption is a plausible one, it will be a severe statistical challenge to
adjust for these covariate differences. Simple least squares regression adjustments are
likely to be sensitive to the exact implementation.
6.3.2

Estimating the Propensity Score for the Non-experimental Lalonde
Data

The first step is to estimate the propensity score on the full sample. I selected the
two prior earnings measures, and the two indicators for these measures being positive
for automatic inclusion in the propensity score. The selection algorithm selected five
additional linear terms, leaving only education as a covariate that was not selected.
The algorithm then selected five second order terms, many of them involving the lagged
earnings and employment measures. Table 17 presents the parameter estimates for this
specification.
Clearly the second order terms are important here. The value of the log likelihood
function at the maximum likelihood estimates is -408.8. If instead we use a simple linear
specification with all ten covariates, the value of the log likelihood function is -474.5. The
correlation between the log odds ratio (the logarithm of the ratio of the propensity score
over one minus the propensity score) for the specification involving second order terms
versus only linear terms is only 0.70. It appears unlikely that the linear specification
of the propensity score will lead to an accurate approximation to the true conditional
expectation.
6.3.3

Matching the Non-experimental Lalonde Data to Improve Balance

In this case we are interested in the average effect on the treated. Because we have a large
number of potential controls we use the matching from Section 5.6.1 to obtain a more
balanced sample. Specifically, I match the 185 treated individuals to the closest controls,
without replacement. The match quality is not always high for this data set. Out of
[41]

the 185 matches, there are 30 matches with difference in log odds ratio larger than 1.00.
These are treated units with a propensity score between 0.74 and 0.89, matched with
control units with propensity scores between 0.49 and 0.69. Although these differences
are substantial, it is plausible that the further adjustment procedures suggested in this
paper are effective in removing them. In Table 18 we report the normalized differences for
the original sample (the same as before in 16), the normalized differences in the matched
sample, and the ratio of the two. Compared to the normalized differences prior to the
matching, the normalized differences after propensity score matching are substantially
smaller. Whereas before there were six (out of ten) normalized differences in excess of
1.00, now none of the normalized differences are larger than 0.28, with most smaller than
0.10. The remaining normalized differences are still substantial, and they highlight that
the simple matching has not removed all covariate differences between treated and control
units, as also evidenced by the poor match quality for some of the matches. Nevertheless,
because the differences are so much smaller, it will now be more reasonable to expect
various estimators to be able to remove most of the remaining differences.
We then re-estimate the propensity score on the matched sample. This time only
two covariates are selected for inclusion in the linear propensity score beyond the four
automatically selected. These two covariates are married and nodegree. In addition
two second order terms are included. Table 19 presents the parameter estimates for this
specification.
6.3.4

Assessing Unconfoundedness for the Non-experimental Lalonde Data

The next step is to assess the plausibility of the unconfoundedness assumption by estimating treatment effects for two pseudo outcomes, Earn ’75, and (Earn ’74+Earn
’75)/2. in Table 20 presents the results, using both the bias-adjusted matching estimator and the blocking estimator. All four estimates are substantively large and we can
in all four cases soundly reject the null hypothesis that the effect of the treatment on
the pseudo outcome is zero. The conclusion is that we cannot be confident here that
unconfoundedness holds based on these analyses.
[42]

It is interesting though to note that the estimated effect for the second pseudo outcome, (Earn ’74+Earn ’75)/2, where we only adjust for the six non-earnings related
covariates, is much larger in absolute value than the estimated effect for the first pseudo
outcome, Earn ’75. In the latter case we adjust for differences in earnings in 1974
for treated and controls. This combination of results does suggest that with additional
earnings measures unconfoundedness might be more plausible.
6.3.5

Subclasses for the Non-experimental Lalonde Data

For comparison with the experimental Lalonde data it is useful to compare the subclasses
constructed by the blocking method. Here the method leads to five blocks. Table 21
presents the block boundaries and the number of control and treated units in each block.
In the matched sample, before the blocking, the average estimated propensity score for
the 185 treated individuals is 0.53 and the average estimated propensity score for the
185 matched control individuals is 0.47, with a difference of 0.06. Within four of the five
blocks the difference in average propensity score values for treated and controls is 0.01 or
less, with only in the first block the difference in average values for the propensity score
equal to 0.05.
6.3.6

Estimating Average Treatment Effects for the Non-experimental Lalonde
Data

Finally, Table 22 presents the results for the actual outcome, earnings in 1978. I report
estimates without regression adjustment, with regression adjustment for the four a priori
selected covariates and with covariate adjustment for all ten covariates. I report these
estimates for the full sample with 15,992 controls, for the matched sample without further
blocking, for the matched sample with two blocks and finally, for the matched sample
with the optimal number of blocks. The estimates are fairly robust once I use at least
two blocks for the matched samples, or even in the single block case with regression
adjustment for the full set of ten covariates. In addition, the estimates are fairly close to
the estimates based on the experimental sample.

[43]

6.3.7

Conclusions for the Non-experimental Lalonde Data

The results for the non-experimental Lalonde data are interesting and quite different from
those of the other data sets. The point estimates are fairly close to the estimates based
on the experimental data, and the estimates are robust to changes in the specification.
However, the estimates based on the pseudo outcomes suggest we would not have been
able to ascertain that the unconfoundedness assumption was plausible based on the nonexperimental data alone. We would have needed additional lagged measures of earnings
to get a better assessment of the unconfoundedness assumption.

7

Conclusion

In this paper I have outlined a strategy for estimating average treatment effects in settings
with unconfoundedness. I have described a specific algorithm to estimate the propensity score in a flexible manner and to implement subclassification and matching methods
based on Imbens and Rubin (2013). I stressed the importance of dropping units with
extreme values of the propensity score to obtain a more balance sample. I also described
a method for assessing the plausibility of the unconfoundedness assumption. These methods are illustrated on three data sets, and are seen to lead to robust estimates for average
treatment effects in all three cases. In two of the examples, with the lottery data and the
experimental Lalonde data, the data pass the test that suggests that unconfoundedness
is plausible. In the third case, with the non-experimental Lalonde data, we cannot be
confident that unconfoundedness holds based on the data. Thus we would be less sure
about the findings absent the experimental estimates as a benchmark, which in a normal
study the researcher does not have.

[44]

Appendix
A. Estimating the Propensity Score
Given the choices, XB , Clin , and Cqua , the algorithm selects covariates for inclusion in the
specification of the propensity score using the following eleven steps.
1. Estimate the logistic regression model, by maximum likelihood, with the basic covariates
XB .
2. Estimate K + 1 − KB additional logistic regression models where each model includes a
single additional element of X not included in XB . In each case calculate the likelihood
ratio test statistic for the null hypothesis that the coefficient on this additional variable
is equal to zero against the alternative hypothesis that the coefficient on this additional
covariate differs from zero.
3. If the largest of the K + 1 − KB likelihood ratio test statistics is smaller than Clin , go to
step 6. If the the largest of the likelihood ratio test statistics is larger than or equal to
Clin , select the corresponding covariate for inclusion in the vector h(·), and go to step 4.
4. At this stage KB +KL linear terms have been selected for inclusion in the propensity score.
Estimate K + 1 − KB − KL logistic regressions, each with the already selected KB + KL
covariates, plus one of the remaining covariates at a time. For each case calculate the
likelihood ratio test statistic for the null hypothesis that the coefficient on this additional
variable is equal to zero against the alternative hypothesis that it differs from zero.
5. If the largest largest of the likelihood ratio test statistics is smaller than Clin , go to Step
6. If the the largest of the likelihood ratio test statistics is larger than or equal to Clin ,
select the corresponding covariate for inclusion in the vector h(·), and return to Step 4.
6. At this stage KB +KL linear terms have been selected (including the intercept), and none
of the remaining covariates would improve the log likelihood more than by Clin /2 (given
that the likelihood ratio statistic is twice the difference in log likelihood values). Now I will
select a subset of the second order terms. I only consider second order terms for covariates
that have been selected for inclusion in the linear part of the specification. Excluding the
intercept that leaves KB + KL − 1 linear terms, and thus (KB + KL − 1) × (KB + KL)/2
potential second order terms. I follow essentially the same algorithm as for the linear
case for deciding which of these second order terms to include, but with the threshold for
the likelihood ratio test statistic equal to Cqua instead of Clin .
7. Estimate (KB + KL − 1) × (KB + KL )/2 logistic regression models, each including the
KB + KL linear terms, and one second order term. Calculate the likelihood ratio test
statistics for the null hypothesis that the coefficient on the second order term is equal to
zero.
8. If the largest largest of the likelihood ratio test statistics is smaller than Cqua , go to Step
11. If the largest of the likelihood ratio test statistics is larger than or equal to Clin , select
the corresponding second order term for inclusion in the vector h(·).

[45]

9. At this point there are KB + KL linear terms selected, and KQ second order terms.
Estimate (KB + KL − 1) × (KB + KL)/2 − KQ logistic regression models, each including
the KB + KL + KQ terms already selected, and one of the remaining second order terms.
Calculate the likelihood ratio test statistic for testing the null that the additional second
order term has a zero coefficient.
10. If the largest largest of the likelihood ratio test statistics is smaller than Cqua , go to Step
11. If the largest of the likelihood ratio test statistics is larger than or equal to Cqua ,
select the corresponding second order term for inclusion in the vector h(·), and go to step
9.
11. The vector h(·) now consists of the KB terms selected a priori, the KL linear terms, and
the KQ second order terms. Estimate the propensity score by maximum likelihood using
this specification.
This algorithm will always converge to some specification for the propensity score. It need not
select all covariates that are important, and it may select some that are not important, but it
can generally provide a reasonable starting point for the specification of the propensity score.
It is likely that it will lead to a substantial improvement over simply including all linear terms
and no second order terms. Incidentally, this algorithm would lead to the linear specification
if one fixed Clin = 0 (so that all linear terms would be included), and Cqua = ∞ (so that no
second order terms would be included).
B. Weights for Various Estimators
Here I briefly show what the weights are for some widely used estimators.
B.1 Difference Estimator
obs
obs
For the difference in average outcomes for treated and control units, τ̂ = Y t − Y c we have
λi = 1.
The weights for all units are equal to one.
B.2 Regression Estimator
Consider the least squares estimator in the regression with a scalar covariate Xi,
Yiobs = α + τ · Wi + β · Xi + εi .
The weights are
λi =

2 (N (N − 1)/N 2 ) + (N /N )(N /N )(X − X )(X − X)
SX
c
t
c
t
c
i
,
2
2
(Nt(N − 1)/N )SX − (Nt/N )(Nc/N )(X t − X c )2

PN
2 =
2
where SX
i=1 (Xi − X) /(N − 1) is the sample variance of Xi . Here the weights are not
necessarily all positive.
B.3 Subclassification Estimator
For the subclassification estimator let the number of units in subclass j be equal to Nj , and
the number of control and treated units in this subclass be equal to Nc,j and Nt,j respectively,

[46]

and let Bi (j) be an indicator for unit i falling in subclass j. Then

if Wi = 0, Bi (j) = 1,
 (Nc/Ncj ) · (Nj /N ),
λi =

(Nt/Ntj ) · (Nj /N ),
if Wi = 1, Bi (j) = 1.

B.4 Matching Estimator
A matching estimator with 1 matches for each treated and control unit has the form,
τ̂ match =

N

1 X
Ŷi (1) − Ŷi (0) ,
N
i=1

where
Ŷi (w) =



Yiobs
obs
Yj(i)

if Wi = w,
if Wi =
6 w,

ensuring that Ŷi (w) is a linear combination of Yjobs with positive weights.
B.5 Weighting Estimator
The weighting estimator (Hirano, Imbens, and Ridder, 2003), has the form
 X
 X
X
X
Yi
1
Yi
1
τ̂ =
−
,
e(Xi )
e(Xi)
1 − e(Xi)
1 − e(Xi)
i:Wi =1

i:Wi =1

i:Wi =0

i:Wi =0

so that

λi =









Nc
1−e(Xi )
Nt
e(Xi )


P

1
j:Wj =0 1−e(Xj ) ,


P

1
j:Wj =1 e(Xj ) ,

if Wi = 0,
if Wi = 1.

Here the weights are all positive.

References
Abadie, A., S. Athey, G. Imbens, and J. Wooldridge, (2014), “Finite Population
Standard Errors,”Unpublished Manuscript.
Abadie, A., and G. Imbens, (2006), “Large Sample Properties of Matching Estimators for
Average Treatment Effects,”Econometrica, 74(1), 235-267.
Abadie, A., and G. Imbens, (2008), “On the Failure of the Bootstrap for Matching Estimators,”Econometrica.
Abadie, A., D. Drukker, H. Herr, and G. Imbens, (2003), “Implementing Matching
Estimators for Average Treatment Effects in STATA,”The Stata Journal, 4(3), 290-311.
Angrist, J. D. and A. B. Krueger (2000), “Empirical Strategies in Labor Economics,”in
A. Ashenfelter and D. Card eds. Handbook of Labor Economics, vol. 3. New York:
Elsevier Science.
Angrist, J., and S. Pischke (2009), Mostly Harmless Econometrics: An Empiricists’ Companion, Princeton University Press, Princeton, NJ.

[47]

Ashenfelter, O., and D. Card, (1985), “Using the Longitudinal Structure of Earnings
to Estimate the Effect of Training Programs”, Review of Economics and Statistics, 67,
648-660.
Becker, S., and A. Ichino, (2002), “Estimation of Average Treatment Effects Based on
Propensity Scores,”The Stata Journal, 2(4): 358-377.
Belloni, A., V. Chernozhukov, and C. Hansen (2012), “Inference on treatment effects
after selection amongst high-dimensional controls,”CMAP working paper.
Busso, M., J. DiNardo, , and J. McCrary. (2008), “Finite Sample Properties of Semiparametric Estimators of Average Treatment Effects,”, Unpublished Manuscript, Department of Economics, University of Michigan.
Caliendo, M., (2006), Microeconometric Evaluation of Labour Market Policies, Springer
Verlag, Berlin.
Caliendo, M., and S. Kopeinig, (2011), “Some practical guidance for the implementation
of propensity score matching”, Journal of Economic Surveys, Vol. 22(1): 31-72.
Card, D., and D. Sullivan, (1988), “Measuring the Effect of Subsidized Training Programs
on Movements In and Out of Employment”, Econometrica, vol. 56, no. 3, 497-530.
Chen, X., H. Hong, and . Tarozzi, (2008), “Semiparametric efficiency in GMM models
with auxiliary data,”Annals of Statistics.
Belloni, A., V. Chernozhukov, and C. Hansen, (2012), “Inference on treatment effects
after selection amongst high-dimensional controls,”Working Paper, MIT.
Cochran, W., (1968) “The Effectiveness of Adjustment by Subclassification in Removing
Bias in Observational Studies”, Biometrics 24, 295-314.
Crump, R., V. J. Hotz, V. J., G. Imbens, and O.Mitnik, (2008a), “Dealing with Limited
Overlap in Estimation of Average Treatment Effects,”Biometrika.
Crump, R., V. J. Hotz, V. J., G. Imbens, and O.Mitnik, (2008b), “Nonparametric Tests
for Treatment Effect Heterogeneity,”Review of Economics and Statistics.
Dawid, P. (1979), “Conditional Independence in Statistical Theory,”Journal of the Royal
Statistical Society, Series B, Vol. 41(1), 1-31.
Dehejia, R., and S. Wahba, (1999), “Causal Effects in Nonexperimental Studies: Reevaluating the Evaluation of Training Programs”, Journal of the American Statistical Association, 94, 1053-1062.
Fisher, R. A., (1925),The Design of Experiments, 1st ed, Oliver and Boyd, London.
Frölich, M. (2000), “Treatment Evaluation: Matching versus Local Polynomial Regression,”Discussion paper 2000-17, Department of Economics, University of St. Gallen.
Frölich, M. (2004), “Finite Sample Properties of Propensity-Score Matching and Weighting
Estimators ,”Review of Economics and Statistics, Vol 86(1): 77-90.
Frölich, M. (2002), “A Note on the Role of the Propensity Score for Estimating Average
Treatment Effects,”Econometric Reviews Vol 23(2): 167-174.
Frölich, M. (2004), “Finite-Sample Properties of Propensity-Score Matching and Weighting
Estimators,”Review of Economics and Statistics, Vol. 86(1), 77-90.
Guo, S., and M. Fraser, (2010), Propensity Score Analysis, Sage, Los Angeles.
Hahn, J., (1998), “On the Role of the Propensity Score in Efficient Semiparametric Estimation
of Average Treatment Effects,”Econometrica 66 (2), 315-331.
Hahn, J., and G. Ridder, (2013), “Asymptotic Variance of Semiparametric Estimators
With Generated Regressors ”Econometrica 81(1): 315-340.
Hainmueller, J., (2012), “Entropy Balancing for Causal Effects: A Multivariate Reweighting Method to Produce Balanced Samples in Observational Studies”Political Analysis.

[48]

Hanson, and A. Sunderam, (2012), “The Variance of Non-Parametric Treatment Effect
Estimators in the Presence of Clustering,” The Review of Economics and Statistics, Vol.
94, No. 4, Pages 1197-1201.
Heckman, J., and J. Hotz, (1989), “Alternative Methods for Evaluating the Impact of
Training Programs”, (with discussion), Journal of the American Statistical Association.,
Vol. 84, No. 804, 862-874.
Heckman, J., and E. Vytlacil (2007), “Econometric Evaluation of Social Programs, Part
I: Causal Models, Structural Models and Econometric Policy Evaluation,”in J. Heckman
and E. Leamer eds. Handbook of Econometrics, vol. 6B, Chapter 70, 4779-4874. New
York: Elsevier Science.
Hirano, K., G. Imbens, and G. Ridder, (2003), “Efficient Estimation of Average Treatment Effects Using the Estimated Propensity Score,”Econometrica, 71(4): 1161-1189.
July
Imbens, G., (2004), “Nonparametric Estimation of Average Treatment Effects Under Exogeneity: A Review,”Review of Economics and Statistics, 86(1): 1-29.
Imbens, G., and D. Rubin, (forthcoming), Causal Inference, Cambridge University Press.
Imbens, G., D. Rubin, and B. Sacerdote, (2000), “Estimating the Effect of Unearned
Income,”American Economic Review.
Imbens, G, and J. Wooldridge, (2009), “”Journal of Economic Literature, (): .
Lalonde, R.J., (1986), “Evaluating the Econometric Evaluations of Training Programs with
Experimental Data,”American Economic Review, 76, 604-620.
Lee, M.-J., (2005), Micro-Econometrics for Policy, Program, and Treatment Effects Oxford
University Press, Oxford.
Millimet, D., and R. Tchernis, (2009), “On the Specification of Propensity Scores, With
Applications to the Analysis of Trade Policies,”Journal of Business and Economic Statistics, 397-415.
Morgan, S. and C. Winship, (2007), Counterfactuals and Causal Inference, Cambridge
University Press, Cambridge.
Murnane, R., and J. Willett, (2010), Methods Matter, Oxford University Press, Oxford.
Neyman, J., (1923), “On the Application of Probability Theory to Agricultural Experiments.
Essay on Principles. Section 9,”translated in Statistical Science, (with discussion), Vol 5,
No 4, 465–480, 1990.
Quade, D., (1982), “Nonparametric Analysis of Covariance by Matching”, Biometrics, 38,
597-611.
Rosenbaum, P., (1989), “Optimal Matching in Observational Studies”, Journal of the American Statistical Association, 84, 1024-1032.
Rosenbaum, P., (1995), Observational Studies, Springer Verlag, New York.
Rosenbaum, P., (2010), Design of Observational Studies, Springer Verlag, New York.
Rosenbaum, P., and D. Rubin, (1983), “The Central Role of the Propensity Score in
Observational Studies for Causal Effects”, Biometrika, 70, 41-55.
Rosenbaum, P., and D. Rubin, (1984), “Reducing the Bias in Observational Studies Using
Subclassification on the Propensity Score”, Journal of the American Statistical Association, 79, 516-524.
Rubin, D., (1973a), “Matching to Remove Bias in Observational Studies”, Biometrics, 29,
159-183.
Rubin, D., (1973b), “The Use of Matched Sampling and Regression Adjustments to Remove
Bias in Observational Studies”, Biometrics, 29, 185-203.

[49]

Rubin, D. (1974), “Estimating Causal Effects of Treatments in Randomized and Non-randomized
Studies,”Journal of Educational Psychology, 66, 688-701.
Rubin, D., (1979), “Using Multivariate Matched Sampling and Regression Adjustment to
Control Bias in Observational Studies,”Journal of the American Statistical Association,
74, 318-328.
Rubin, D. B., (1990), “Formal Modes of Statistical Inference for Causal Effects,”J ournal of
Statistical Planning and Inference, 25, 279-292.
Rubin, D., and N. Thomas, (1992a), “Affinely Invariant Matching Methods with Ellipsoidal
Distributions,”Annals of Statistics 20 (2) 1079-1093.
Rubin, D., and N. Thomas, (1992b), “Characterizing the effect of matching using linear
propensity score methods with normal distributions,” Biometrika 79 797-809.
Sekhon, J., (2009), “Opiates for the Matches: Matching Methods for Causal Inference”Annual
Review of Political Science.
Tibshirani, R., (1996), “Regression Shrinkage and Selection via the Lasso,”Journal of the
Royal Statistical Society, Vol. 58(1): 267-288.
Wooldridge, J., (2002), Econometric Analysis of Cross Section and Panel Data, MIT Press,
Cambridge, MA.

[50]

Table 1: Summary Statistics Lottery Data
Covariate

Losers (N=259) Winners (N=237)
mean
(s.d.)
mean
(s.d.)

Year Won
# Tickets
Age
Male
Education
Working Then
Earn Y -6
Earn Y -5
Earn Y -4
Earn Y -3
Earn Y -2
Earn Y -1
Pos Earn Y-6
Pos Earn Y -5
Pos Earn Y -4
Pos Earn Y -3
Pos Earn Y -2
Pos Earn Y-1

6.38
2.19
53.2
0.67
14.4
0.77
15.6
16.0
16.2
16.6
17.6
18.0
0.69
0.68
0.69
0.68
0.68
0.69

1.04
1.77
12.9
0.47
2.0
0.42
14.5
15.0
15.4
16.3
16.9
17.2
0.46
0.47
0.46
0.47
0.47
0.46

6.06
4.57
47.0
0.58
13.0
0.80
12.0
12.1
12.0
12.8
13.5
14.5
0.70
0.74
0.73
0.73
0.74
0.74

[51]

1.29
3.28
13.8
0.49
2.2
0.40
11.8
12.0
12.1
12.7
13.0
13.6
0.46
0.44
0.44
0.44
0.44
0.44

t-stat

nor-dif

-3.0
9.9
-5.2
-2.1
-7.8
0.9
-3.1
-3.2
-3.4
-2.9
-3.1
-2.5
0.3
1.6
1.1
1.4
1.6
1.2

-0.27
0.90
-0.47
-0.19
-0.70
0.08
-0.27
-0.28
-0.30
-0.26
-0.27
-0.23
0.03
0.14
0.10
0.13
0.15
0.10

Table 2: Estimated Parameters of Propensity Score for the Lottery Data
Variable

est

s.e.

intercept

30.24

0.13

preselected linear terms
Tickets Bought
Education
Working Then
Earnings Year -1

0.56
0.87
1.71
-0.37

0.38
0.62
0.55
0.09

additional linear terms
Age
Year Won
Pos Earnings Year -5
Male

-0.27
-6.93
0.83
-4.01

0.08
1.41
0.36
1.71

second order terms
Year Won× Year Won
0.50
Earnings Year -1× Male
0.06
Tickets Bought× Tickets Bought -0.05
Tickets Bought× Working Then
-0.33
Education× Education
-0.07
Education× Earnings Year -1
0.01
Tickets Bought× Education
0.05
Earnings Year -1× Age
0.002
Age × Age
0.002
Year Won× Male
0.44

0.11
0.02
0.02
0.13
0.02
0.00
0.02
0.001
0.001
0.25

[52]

Table 3: Alternative Specifications of the Propensity Score

Baseline No Pre-selected Clin = 0, Cqua = ∞
Degrees Of Freedom

lasso

18

18

18

12

-201.5

-201.5

-231.7

-229.1

Correlations of Log Odds Ratios
Baseline

1.00

1.00

0.86

0.86

No Pre-selected

1.00

1.00

0.86

0.86

Clin = 0, Cqua = ∞

0.86

0.86

1.00

0.98

lasso

0.86

0.86

0.98

1.99

Log Likelihood Function

Table 4: Sample Sizes for Subsamples with the Propensity Score between
α and 1 − α (α = 0.0891) by Treatment Status.

Losers
Winners
All

low
e(x) < α

middle
α ≤ e(X) ≤ 1 − α

high
1 − α < e(X)

All

82
4
86

172
151
323

5
82
87

259
237
496

[53]

Table 5: Summary Statistics Trimmed Lottery Data
Covariate

Losers (N=172) Winners (N=151)
mean
(s.d.)
mean
(s.d.)

Year Won
# Tickets
Age
Male
Education
Work Then
Earn Year -6
Earn Year -5
Earn Year -4
Earn Year -3
Earn Year -2
Earn Year -1
Pos Earn Year
Pos Earn Year
Pos Earn Year
Pos Earn Year
Pos Earn Year
Pos Earn Year

6.40
2.40
51.5
0.65
14.0
0.79
15.5
16.0
16.4
16.8
17.8
18.4
0.71
0.70
0.71
0.70
0.70
0.72

-6
-5
-4
-3
-2
-1

1.12
1.88
13.4
0.48
1.9
0.41
14.0
14.4
14.9
15.6
16.4
16.6
0.46
0.46
0.46
0.46
0.46
0.45

6.32
3.67
50.4
0.60
13.0
0.80
13.0
13.3
13.4
14.3
14.7
15.4
0.71
0.74
0.74
0.72
0.72
0.71

[54]

1.18
2.95
13.1
0.49
2.2
0.40
12.4
12.7
12.7
13.3
13.8
14.4
0.46
0.44
0.44
0.45
0.45
0.46

t-stat

nor-dif

-0.6
4.6
-0.7
-1.0
-4.2
0.2
-1.7
-1.8
-2.0
-1.6
-1.8
-1.7
-0.0
0.9
0.5
0.2
0.5
-0.1

-0.06
0.51
-0.08
-0.11
-0.47
0.03
-0.19
-0.20
-0.22
-0.18
-0.20
-0.19
-0.00
0.10
0.06
0.03
0.05
-0.01

Table 6: Estimated Parameters of Propensity Score for the Trimmed Lottery Data
Variable

est

s.e.

intercept

21.77 0.13

pre-selected linear terms
Tickets Bought
Years of Schooling
Working Then
Earnings Year -1

-0.08
-0.45
3.32
-0.02

0.46
0.08
1.95
0.01

additional linear terms
Age
Pos Earnings Year -5
Year Won
Earnings Year -5

-0.05
1.27
-4.84
-0.04

0.01
0.42
1.53
0.02

second order terms
Year Won × Year Won
Tickets Bought × Year Won
Tickets Bought × Tickets Bought
Working Then × Year Won

0.37
0.14
-0.04
-0.49

0.12
0.06
0.02
0.30

Table 7: Assessing Unconfoundedness for the Lottery Data: Estimates of
Average Treatment Effects for Pseudo Outcomes
Pseudo Outcome

Blocking
est
(s.e.)

Matching
est
(s.e.)

Y−1

-0.53

(0.78)

-0.10

(0.95)

Y−1 +Y−2
2

-1.16

(0.83)

-0.88

(0.94)

Y−1 +Y−2 +Y−3
3

-0.39

(0.95)

-0.81

(0.98)

[55]

Table 8: Lottery Data: Estimates of Average Treatment Effects
Cov

Full Sample
1 Block Match

Trimmed
1 Block 2 Blocks 5 Blocks Match

No

-6.16
(1.34)

-4.03
(1.32)

-6.64
(1.66)

-6.05
(1.87)

-5.66
(1.99)

-4.53
(1.36)

Few

-2.85
(0.99)

-4.29
(1.31)

-3.99
(1.16)

-5.57
(1.30)

-5.07
(1.46)

-4.19
(1.36)

All

-5.08
(0.93)

-5.77
(1.31)

-5.34
(1.10)

-6.35
(1.29)

-5.74
(1.40)

-5.00
(1.36)

Table 9: Lottery Data: Sensitivity of Estimates of Average Treatment
Effcts to Propensity Score Specification

Cov

Preferred Specification Linear Specification
CL = 1, CQ = 2.71
CL = 0, CQ = ∞
lasso
Blocked
Match
Blocked
Match
Blocked Match

No

-5.66
(1.99)

-4.53
(1.36)

-4.61
(2.08)

-3.62
(1.56)

-3.34
1.95

-3.50
1.24

Few

-5.07
(1.46)

-4.19
(1.36)

-4.52
(1.46)

-2.39
(1.56)

-3.91
1.35

-2.97
1.24

All

-5.74
(1.40)

-5.00
(1.36)

-5.21
1.60

-3.71
1.56

-3.64
1.31

-3.78
1.24

[56]

Table 10: Summary Statistics for Experimental Lalonde Data

Covariate

experimental controls
trainees
(Nc =260)
(Nt =185)
mean
(s.d.)
mean (s.d.) t-stat

Black
0.83
Hisp
0.11
Age
25.05
Married
0.15
Nodegree
0.83
Education 10.09
E’74
2.11
U’74
0.75
E’75
1.27
U’75
0.68

0.38
0.31
7.06
0.36
0.37
1.61
5.69
0.43
3.10
0.47

0.84
0.06
25.82
0.19
0.71
10.35
2.10
0.71
1.53
0.60

[57]

0.36
0.24
7.16
0.39
0.46
1.97
4.89
0.46
3.22
0.49

0.5
-1.9
1.1
1.0
-3.1
1.4
-0.0
-1.0
0.9
-1.8

nor-dif
0.04
-0.17
0.11
0.09
-0.30
0.14
-0.00
-0.09
0.08
-0.18

Table 11: Estimated Parameters of Propensity Score for the Lalonde Experimental Data
Variable

est

s.e.

intercept

-3.48

0.10

pre-selected linear terms
earn ’74
unempl ’74
earn ’75
unempl ’75

0.03
-0.24
0.06
-3.48

0.05
0.39
0.05
1.65

additional linear terms
nodegree
hispanic
education

7.33
-0.65
0.29

4.25
0.39
0.37

second order terms
nodegree × education -0.67
earn ’74 × nodegree
-0.13
unempl ’75 × eduction 0.30

0.35
0.06
0.16

[58]

Table 12: Sample Sizes for Subsamples with the Propensity Score between
α and 1 − α (α = 0.1299) by Treatment Status.

Controls
Treated
All

low
e(x) < α

middle
α ≤ e(X) ≤ 1 − α

high
1 − α < e(X)

All

4
1
5

256
182
438

0
2
2

260
185
445

Table 13: Subclasses
Subclass

Pscore
Min Max

1
2
3

0.07
0.38
0.49

0.38
0.49
0.85

# Controls # Treated

152
52
52

67
42
73

ave pscore
average difference
controls treated
in pscore
t-stat

0.32
0.42
0.56

0.33
0.42
0.58

0.01
0.01
0.02

Table 14: Assessing Unconfoundedness for the Lottery Data: Estimates of
Average Treatment Effects for Pseudo Outcomes
Pseudo Outcome

Blocking
est (s.e.)

Matching
est
(s.e.)

earn ’75

0.22

(0.22)

0.03

(0.27)

(earn ’74+earn ’75)/2

0.03

(0.36)

-0.08

(0.41)

[59]

0.8
1.0
1.4

Table 15: Experimental Lalonde Data: Estimates of Average Treatment
Effects
Cov

Full Sample
1 Block Match

Trimmed Sample
1 Block 2 Blocks 3 Blocks Match

No

1.79
(0.67)

2.21
(0.82)

1.69
(0.66)

1.49
(0.68)

1.48
(0.68)

2.30
(0.81)

Few

1.74
(0.67)

2.15
(0.82)

1.60
(0.66)

1.54
(0.66)

1.52
(0.68)

2.26
(0.81)

All

1.67
(0.64)

2.11
(0.82)

1.56
(0.65)

1.56
(0.64)

1.46
(0.65)

2.26
(0.81)

Table 16: Summary Statistics for Non-experimental Lalonde Data

Covariate

CPS controls (Nc =15,992)
mean
(s.d.)

trainees (Nt=185)
mean
(s.d.)

t-stat

nor-dif

Black
Hisp
Age
Married
Nodegree
Education
E’74
U’74
E’75
U’75

0.07
0.07
33.23
0.71
0.30
12.03
14.02
0.12
13.65
0.11

0.84
0.06
25.82
0.19
0.71
10.35
2.10
0.71
1.53
0.60

28.6
-0.7
-13.9
-18.0
12.2
-11.2
-32.5
17.5
-48.9
13.6

2.43
-0.05
-0.80
-1.23
0.90
-0.68
-1.57
1.49
-1.75
1.19

0.26
0.26
11.05
0.45
0.46
2.87
9.57
0.32
9.27
0.31

[60]

0.36
0.24
7.16
0.39
0.46
2.01
4.89
0.46
3.22
0.49

Table 17: Estimated Parameters of Propensity Score for the Lalonde Nonexperimental (CPS) Data
Variable

est

s.e.

-16.20

(0.69)

0.41
0.42
-0.33
-2.44

(0.11)
(0.41)
(0.06)
(0.77)

4.00
-1.84
1.60
1.61
0.73

(0.26)
(0.30)
(0.22)
(0.41)
(0.09)

second order terms
age × age
-0.007
unempl ’74 × unempl ’75 3.41
earn ’74 × age
-0.013
earn ’75 × married
0.15
unempl ’74 × earn ’75
0.22

(0.002)
(0.85)
(0.004)
(0.06)
(0.09)

intercept
pre-selected linear terms
earn ’74
unempl ’74
earn ’75
unempl ’75
additional linear terms
iblack
married
nodegree
hispanic
age

[61]

Table 18: Normalized Differences Before and After Matching for Nonexperimental Lalonde Data

Full Sample Matched Sample ratio of
nor-dif
nor-dif
nor-dif
Black
Hispanic
Age
Married
Nodegree
Education
E’74
U’74
E’75
U’75

2.43
-0.05
-0.80
-1.23
0.90
-0.68
-1.57
1.49
-1.75
1.19

0.00
0.00
-0.15
-0.28
0.25
-0.18
-0.03
0.02
-0.07
0.02

0.00
-0.00
0.19
0.22
0.28
0.26
0.02
0.02
0.04
0.02

Table 19: Estimated Parameters of Propensity Score for the Matched
Lalonde Nonexperimental (CPS) Data
Variable

est

s.e.

intercept
-0.15 0.11
pre-selected linear terms
earn ’74
0.03 0.04
unempl ’74
-0.00 0.42
earn ’75
-0.06 0.05
unempl ’75
0.26 0.36
additional linear terms
married
nodegree

-0.52 0.55
0.26 0.26

second order terms
unempl ’75 × married
married × nodegree

-1.24 0.55
1.10 0.55

[62]

Table 20: Assessing Unconfoundedness for the Non-experimental Lalonde
Data: Estimates of Average Treatment Effects for Pseudo Outcomes
Pseudo Outcome

Blocking
est
(s.e.)

Matching
est
(s.e.)

earn ’75

-1.22

(0.25)

-1.24

(0.30)

(earn ’74+earn ’75)/2

-6.13

(0.49)

-6.37

(0.67)

Table 21: Subclasses
Subclass

1
2
3
4
5

Pscore
Min Max

0.00
0.37
0.43
0.46
0.53

0.37
0.43
0.46
0.53
1.00

# Controls # Treated

31
5
26
36
87

7
7
22
36
113

average pscore
difference in
controls treated average pscore

0.20
0.39
0.44
0.50
0.57

0.25
0.40
0.44
0.50
0.58

t-stat

0.05
0.00
0.00
0.00
0.01

Table 22: Non-experimental Lalonde Data: Estimates of Average Treatment Effects
Cov

Full Sample
1 Block Match

Trimmed Sample
1 Block 2 Blocks 4 Blocks Match

No

-8.50
(0.58)

1.72
(0.90)

1.72
(0.74)

1.81
(0.75)

1.79
(0.76)

1.98
(0.85)

Few

0.69
(0.59)

1.73
(0.90)

1.81
(0.73)

1.80
(0.73)

2.10
(0.75)

1.98
(0.85)

All

1.07
(0.55)

1.81
(0.90)

1.97
(0.66)

1.90
(0.67)

1.93
(0.70)

2.06
(0.85)

[63]

1.75
0.39
0.18
0.51
1.14

Fig 1: Histogram of Earnings in 1975 for Control Group
300
200
100
0

0

20

40

60

80

100

120

140

160

140

160

Fig 2: Histogram of Earnings in 1975 for Treatment Group
100

50

0

0

20

40

60

80

100

120

Fig 3: Linear and Log Linear Regression Functions, and Quartiles of Earnings Distributions

100
50
0

0

20

40

60

80

100

120

140

160

