NBER WORKING PAPER SERIES

ESTIMATING THE EFFECT OF TREATMENTS ALLOCATED BY RANDOMIZED
WAITING LISTS.
ClÃ©ment de Chaisemartin
Luc Behaghel
Working Paper 26282
http://www.nber.org/papers/w26282

NATIONAL BUREAU OF ECONOMIC RESEARCH
1050 Massachusetts Avenue
Cambridge, MA 02138
September 2019

We would like to thank Hugo Botton for outstanding research assistance. We are very grateful to
Chris Blattman and Jeannie Annan for making their data publicly available, and for answering all
our questions. We are also very grateful to Josh Angrist, Bart Cockx, Xavier D'Haultfoeuille,
Thomas Le Barbanchon, Chang Lee, Ulrich Mueller, Heather Royer, Doug Steigerwald, Chris
Walters, three anonymous referees, members of the UCSB econometrics research group, and
seminar participants at: the 2017 California Econometrics conference, the 2017 Labor and
Education workshop of the NBER Summer Institute, Louvain-la-Neuve, the Paris School of
Economics, UC Santa Barbara, UC San Diego, and Warwick for their helpful comments. The
views expressed herein are those of the authors and do not necessarily reflect the views of the
National Bureau of Economic Research.
NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.
Â© 2019 by ClÃ©ment de Chaisemartin and Luc Behaghel. All rights reserved. Short sections of
text, not to exceed two paragraphs, may be quoted without explicit permission provided that full
credit, including Â© notice, is given to the source.

Estimating the Effect of Treatments Allocated by Randomized Waiting Lists.
ClÃ©ment de Chaisemartin and Luc Behaghel
NBER Working Paper No. 26282
September 2019
JEL No. C21,C26
ABSTRACT
Oversubscribed treatments are often allocated using randomized waiting lists. Applicants are
ranked randomly, and treatment offers are made following that ranking until all seats are filled.
To estimate causal effects, researchers often compare applicants getting and not getting an offer.
We show that those two groups are not statistically comparable. Therefore, the estimator arising
from that comparison is inconsistent when the number of waitlists goes to infinity. We propose a
new estimator, and show that it is consistent, provided the waitlists have at least two seats.
Finally, we revisit an application, and we show that using our estimator can lead to significantly
different results from those obtained using the commonly used estimator.

ClÃ©ment de Chaisemartin
Department of Economics
University of California at Santa Barbara
Santa Barbara, CA 93106
and NBER
clementdechaisemartin@ucsb.edu
Luc Behaghel
Paris School of Economics - Inra
48 boulevard Jourdan
75014 PARIS
FRANCE
luc.behaghel@ens.fr

1 Introduction
Often times, some individuals who apply for a treatment are non-takers. They decline to get
treated when they receive an oer, for instance because they then realize that their benet from
treatment is lower than they thought. When a treatment is oversubscribed but some applicants
are non-takers, an appealing way of allocating the available seats is to use randomized waitlists.
First, applicants are ranked randomly. Then, if
takes place, whereby the rst

S

S

seats are available, an initial round of oers

applicants get an oer. If

round of oers takes place whereby the next

r

r

of them decline it, a subsequent

applicants get an oer. Oers stop when all the

seats have been lled. This allocation method is fair: each taker has the same probability of
being treated; it is also ecient: no seat for treatment remains unused, despite the presence
of non-takers.

Therefore, oversubscribed treatments with non-takers are often allocated by

randomized waitlists.

We conducted a survey, and found 43 articles studying treatments

allocated by randomized waitlists, ranging from charter schools in the USA to agricultural
trainings in Liberia. These treatments often have capacity constraints for various groups of
applicants.

For instance, a charter school may have 20 seats available in 7th grade and 25

seats in 8th grade. Then, a lottery takes place in each group.
As applicants are ranked randomly, it may be possible to form two comparable groups with
dierent likelihoods of getting an oer. One could then compare those two groups to estimate
the eect of the treatment. In practice, researchers have used two types of comparisons. Some
researchers have compared applicants getting and not getting an initial oer, thus giving rise
to the so-called initial-oer (IO) estimators. Other researchers have compared applicants ever
and never getting an oer, thus giving rise to the so-called ever-oer (EO) estimators. When
several lotteries were conducted, as in the charter school example above, researchers have often
included waitlist xed eects in their specications, to ensure they compare applicants within
and not across waitlists.

In our survey, 22 articles used the EO estimator, 20 used the IO

estimator, and a handful used other estimators. Overall, practices are not standardized.
We start by showing that the expected proportion of takers is strictly greater among applicants
ever getting an oer than among applicants never getting one. Intuitively, this is because oers
continue until all seats are lled, so the last applicant getting an oer must by construction
be a taker. Moreover, when waitlist xed eects are included in the estimation, they induce
an endogenous reweighting of waitlists that usually further increases this imbalance between
the two groups, as we explain in more detail in Section 2.
Then, we show that due to this imbalance, the EO estimator is inconsistent when the number
of waitlists goes to innity. In our survey, the median of the number of waitlists divided by the
number of applicants per waitlist is 1.9, and 25% of the articles have more than 100 waitlists
and less than 40 applicants per waitlist. This motivates the asymptotic sequence we consider.
By contrast, if the number of applicants and takers per waitlist goes to innity, the asymptotic

2

bias of the EO estimator goes to 0.
We show that dropping the last applicant getting an oer in each waitlist is sucient to
restore the comparability between applicants getting and not getting an oer. Based on this
result, we propose a new estimator of the treatment eect. It is built out of comparisons of
applicants that get and do not get an oer in each waitlist, downweighting applicants that
accept their oer by an amount equivalent to dropping one of them.

Then, our estimator

takes a weighted average of those within-waitlist comparisons, with a weighting scheme that
avoids the endogeneous reweighting induced by the waitlist xed eects.

We refer to that

estimator as the doubly-reweighted ever-oer estimator (DREO). We show that our estimator
is consistent and asymptotically normal when the number of waitlists goes to innity.
Contrary to subsequent-round oers, initial oers are only a function of applicants' random
ranks in the waitlist.

Therefore, applicants getting and not getting an initial oer are sta-

tistically comparable, and the IO estimator is also consistent.

However, we show that the

asymptotic variance of that estimator is often much larger than that of the DREO estimator,
so using it will often result in large eciency losses.
We use our results to revisit Blattman & Annan (2016), who studied the eects of an agricultural training. The DREO estimator is signicantly dierent from the EO estimator computed

1

by the authors for some of the outcomes they considered.

The remainder of the paper is organized as follows. Section 2 uses a simple example to give the
intuition of our results. Section 3 presents our main results. Section 4 presents our empirical
application. Appendix A presents the proofs. In our Web appendix, we present our survey of
articles that have used randomized waitlists, we show that some of the assumptions adopted
in the paper can be relaxed, we present some simulations, and we revisit another application.

2 Introducing the results through a simple example
We start with a simple example.

We consider a waitlist where ve applicants compete for

three seats. Four applicants are takers (T ) and one is a non-taker (N T ), meaning that she
will refuse to get treated if she gets an oer. Applicants are randomly ranked, and treatment
oers are made following that ranking until all seats are lled. There are
of the applicants, that can be divided into 5 groups of

4!

5! possible orderings

orderings, according to the rank of

the non-taker. Table 1 displays those ve groups of orderings, hereafter referred to, slightly
abusively, as orderings. For each ordering, applicants getting an oer are depicted in italics,
while those not getting an oer are depicted in bold.

In ordering 1 and 2, the rst three

applicants are takers, so oers stop after the third oer. In orderings 3, 4, and 5, one of the
rst three applicants is a non-taker, so a fourth oer is made; then the next applicant is a
taker so oers stop as the available seats have been lled.

1

A Stata adole computing the DREO estimator is available from the authors' website.
3

The rst issue with the EO estimator is that, on average, applicants getting an oer bear
a higher proportion of takers than applicants not getting an oer. Each ordering has a

0.20

probability of being selected. Across the ve orderings, the expected share of takers among ap-

0.2Ã—(1 + 1 + 3/4 + 3/4 + 3/4) = 17/20. On the other hand, the expected share of takers among applicants not getting an oer is 0.2 Ã— (1/2 + 1/2 + 1 + 1 + 1) =
4/5. Intuitively, this imbalance arises because oers stop when suciently many takers have

plicants getting an oer is

accepted an oer. This endogenous stopping rule creates a positive correlation between getting an oer and being a taker.

When the average potential outcomes of takers and non

2
takers dier, this imbalance implies that applicants getting and not getting an oer are not
statistically comparable: those two groups have dierent average potential outcomes.
Table 1: Applicants

getting

and

not getting an oer in an example

Ordering 1

Ordering 2

Ordering 3

Ordering 4

Ordering 5

T
T
T

T
T
T

T
T
NT
T

T
NT
T
T

NT
T
T
T

T
NT

NT
T

T

T

T

The second issue with the EO estimator arises from the inclusion of xed eects when pooling
waitlists. Assume that one pools waitlists that all have four takers, one non-taker, and three
seats. In some waitlists, the realized ordering of takers and non-takers is Ordering 1 in Table
1, in other waitlists the realized ordering is Ordering 2, etc. With several waitlists, it follows
from, e.g., Equation (3.3.7) in Angrist & Pischke (2008), that the EO estimator with waitlist
xed eects is a weighted average of the EO estimators in each waitlist, that gives more weight
to waitlists where the share of applicants getting an oer is closer to 1/2. In our example, 3/5
of applicants get an oer in waitlists with Ordering 1 or 2, while 4/5 of applicants get an oer
in waitlists with Ordering 3, 4, or 5. Accordingly, waitlists with Ordering 1 or 2 receive more
weight. But those are precisely the waitlists where the proportion of takers among applicants
getting an oer is the highest.

Therefore, the reweighting of waitlists induced by the xed

eects aggravates the over-representation of takers among applicants getting an oer.
The DREO estimator we propose addresses those two issues. Firstly, in our example dropping
the last taker getting an oer is sucient to solve the endogenous stopping rule issue. Table
2 shows that then, the expected share of takers among applicants getting an oer is equal
to

0.2 Ã— (1 + 1 + 2/3 + 2/3 + 2/3) = 4/5,

the same as among applicants not getting an oer.

Still, dropping the last taker getting an oer is arbitrary: dropping the rst or the second

2

This is often the case. Abadie et al. (2002) and CrÃ©pon et al. (2015) are just a few examples of the many
papers that have found large dierences between the average potential outcomes of takers and non-takers.
4

would have the same eect. Besides, doing so reduces the sample size and statistical precision.
Instead, one can give to the three of them a weight equal to 2/3: this reduces the expected share
of takers among applicants getting an oer by the same amount as dropping one. Secondly,
instead of using xed eects to pool waitlists, we simply take an average of the estimators in
each waitlist, weighting waitlists proportionally to their number of applicants. These weights
are independent of how many oers one has to make to ll the available seats, which solves
the second issue of the EO estimator. Table 2 shows that this second reweighting is necessary.
Even after downweighting takers getting an oer, including waitlist xed eects would still
lead to over-represent takers among applicants getting an oer. Indeed, doing so gives more
weight to waitlists with ordering 1 or 2, where 1/2 of applicants get an oer, while those are
the waitlists where the proportion of takers among applicants getting an oer is the highest.
Table 2:

Applicants

getting

and

not getting

an oer, dropping the last

taker getting an oer
Ordering 1

Ordering 2

Ordering 3

Ordering 4

Ordering 5

T
T

T
T

T
NT

NT
T

T
T
NT

T
NT
T

NT
T
T

T

T

T

3 Main results
3.1 Assumptions and parameter of interest
Throughout the paper, we consider the following set-up.

Assumption 1 (Set-up)
a) Applicants for a binary treatment are divided into K mutually exclusive waitlists. For every
k âˆˆ {1..K}, Nk denotes the number of applicants in waitlist k . Nk is non stochastic.
b) In each waitlist, Sk seats are available, and are allocated as follows: applicants are ranked,
and treatment oers are made following that order until Sk applicants have accepted to get
treated or all applicants have received an oer. Sk is non stochastic.
c) Applicants that do not get an oer cannot get treated.
In Section 4 in the Web appendix, we consider various extensions of this set-up. For instance,
we show that our results remain unchanged if we allow for the possibility that some applicants
manage to get treated even if they do not receive an oer. Similarly, we allow for the possibility

5

that some applicants may participate in several waiting-lists, or that the treatment may not
be binary. But for now we focus on the basic set-up outlined in Assumption 1.
Then, we assume that ranks are randomly assigned to applicants. Let

Rik

denote the rank

i in waitlist k , let Lk denote the number of applicants getting an oer in
waitlist k , and let Zik = 1{Rik â‰¤ Lk } denote whether applicant i gets an oer, the so-called
ever-oer instrument. Let Dik (1) denote her potential treatment if she gets an oer, and let
Dik denote her observed treatment. Under point c) of Assumption 1, Dik = Zik Dik (1). For
3
every d âˆˆ {0, 1}, let Yik (d) denote her potential outcome if Dik = d, and let Yik = Yik (Dik )
assigned to applicant

denote her observed outcome. Let

Pk = ((D1k (1), Y1k (0), Y1k (1)) , ..., (DNk k (1), YNk k (0), YNk k (1)))
k.
Rk = (R1k , ..., RNk k )

be a vector stacking the potential treatments and outcomes of the applicants in waitlist
For any integer

j,

let

Î j

denote the set of permutations of

denote the ranks assigned to applicants

1

to

Nk

in waitlist

{1..j}.
k.

Let

Assumption 2 (Randomly assigned ranks)

For all k âˆˆ {1..K} and (r1 , ..., rNk ) âˆˆ Î Nk , P (Rk = (r1 , ..., rNk )|Pk ) =

1
Nk !

.

Assumption 2 requires that the ranks assigned to applicants be independent of their potential
treatments and outcomes, and uniformly distributed on

Î Nk .

It implies that each applicant

has the same probability of being in the rst, second, ..., or last rank.

Dik (1) = 1 (resp. Dik (1) = 0) be
P k
k âˆˆ {1..K}, let Tk = N
i=1 Dik (1) denote

Finally, we consider a last assumption. Let applicants with
referred to as takers (resp. non-takers). For every
the number of takers in waitlist

k.

Assumption 3 (Strictly more takers than seats)
For every k âˆˆ {1..K}, 2 â‰¤ Sk < Tk .

Assumption 3 requires that each waitlist have at least two seats, so waitlists with less than
two seats have to be dropped from the analysis. Assumption 3 also requires that each waitlist
have strictly more takers than seats. When all the seats available in a waitlist get lled, it
must be that

Sk â‰¤ Tk ,

but it is still possible that

Sk = Tk :

all applicants not getting an oer

might be non-takers. Still, in Section 4.1 of the Web appendix we propose a statistical test of

Sk < Tk for all k , or Sk = Tk for some k .
P
T = K
k=1 Tk denote the total number of takers. Our parameter of
ï£¶
ï£«
X
1
[Yik (1) âˆ’ Yik (0)]ï£¸ ,
âˆ†K = E ï£­
T

whether
Let

interest is

(i,k):Dik (1)=1

the local average treatment eect of the takers.

3

We implicitly assume that getting an oer does not have a direct eect on the outcome, the so-called
exclusion restriction, see Angrist et al. (1996).
6

3.2 The Doubly Reweighted Ever Oer estimator
PK

N
K respectively denote the total number of applicants and the
2
average number of applicants per waitlist. Let I = {(i, k) âˆˆ N : i âˆˆ {1..Nk }, k âˆˆ {1..K}},
Z D
1
and for every (i, k) âˆˆ I , let wik = 1 âˆ’ ik ik . wik is equal to 1 âˆ’
Sk
Sk for applicants that get
Let

N =

k=1 Nk and

N =

1

and accept an oer, and to

for everyone else. As

weighting applicants getting an oer by

wik

Sk

takers receive an oer in each waitlist,

decreases the share of takers among them by the

same amount as dropping one taker, as illustrated in the numerical example in Section 2.
The DREO estimator of

1
K

b =
âˆ†
b
âˆ†

âˆ†K

PK

Nk
k=1 N

is dened as



P
1 P
1
i:Zik =0 Yik
i:Zik =1 wik Yik âˆ’ Nk âˆ’Lk
Lk âˆ’1
P
P
K Nk 1
1
k=1 N Lk âˆ’1
i:Zik =1 wik Dik
K

can be computed through a 2SLS regression. Let

DR
wik


= wik

L=


.

(1)

PK

k=1 Lk , and let

Lâˆ’K
Nk
N âˆ’L
Nk
Zik Ã—
Ã—
+ (1 âˆ’ Zik ) Ã—
Ã—
N âˆ’K
Lk âˆ’ 1
N âˆ’K
Nk âˆ’ Lk

be a weighting scheme combining

wik



with propensity score reweighting. One can show that

b
âˆ†

Dik in a 2SLS regression of Yik on Dik using Zik as the instrument,
PNk
DR
and weighted by wik . Importantly, note that under Assumption 1, Sk =
i=1 Zik Dik , so
is equal to the coecient of

observing

(Zik , Dik , Yik )(i,k)âˆˆ{1..Nk }Ã—{1..K}

is sucient to compute

b.
âˆ†

Our main result relies on the following lemma:

Lemma 3.1 If Assumptions 1-3 hold, then for all k âˆˆ {1..K},
a) E



1
K

PK

b) E



1
K

PK

Nk
k=1 N



1
Lk âˆ’1

Nk 1
k=1 N Lk âˆ’1

P

i:Zik =1 wik Yik âˆ’

P

i:Zik =1 wik Dik



1
Nk âˆ’Lk

P





P

Dik (1)

=E

1
N

i:Zik =0 Yik

(i,k)âˆˆI

=E




1
N

P


[Y
(D
(1))
âˆ’
Y
(0)]
,
ik
ik
ik
(i,k)âˆˆI

.

The intuition of point a) of the theorem goes as follows. As the numerical example in Section
2 illustrates, one can show that in each waitlist,

wik -reweighted

applicants getting an oer

are statistically comparable to applicants not getting an oer. Therefore, the only dierence
between these two groups is that one receives an oer and not the other one. Accordingly,

1
Lk âˆ’1

1
i:Zik =1 wik Yik âˆ’ Nk âˆ’Lk

P

P

outcome of the
i:Zik =0 Yik ,the dierence between the average

P
Nk
1
two groups, is an unbiased estimator of E
i=1 [Yik (Dik (1)) âˆ’ Yik (0)] , the intention to
Nk
treat (ITT) eect of getting an oer on applicants' outcome in waitlist

k.

The numerator of

b
âˆ†

is an average of those unbiased within-waitlist comparisons, that gives to each waitlist a weight
proportional to its number of applicants. Therefore, this numerator is an unbiased estimator
of

E



1
N

P

(i,k)âˆˆI


[Yik (Dik (1)) âˆ’ Yik (0)] ,

the intention to treat eect among all applicants.

The intuition of point b) is similar.

7

We now derive the asymptotic distribution of

b.
âˆ†

In our survey of articles that have used

randomized waitlists, the median number of waitlists used in the analysis is equal to 64.
Therefore, we consider a sequence where

K,

the number of waitlists, goes to innity.

An

alternative would be to consider a sequence where the number of applicants per waitlist goes
to innity, but in our survey the median of waitlists divided by applicants per waitlist is
equal to 1.9, so the former asymptotic may be more appropriate in a majority of applications.

h
i
P
P
1
k âˆˆ {1..K}, let RFk = NNk Lk1âˆ’1 i:Zik =1 wik Yik âˆ’ Nk âˆ’L
Y
and F Sk =
ik
i:Zik =0
k
Nk 1 P
1 PK
i:Zik =1 wik Dik . Let also F S = lim K
k=1 E (F Sk ) and âˆ† = lim âˆ†K , where
N Lk âˆ’1

For all

Kâ†’+âˆž

Assumption 4 below ensures that those limits exist. Finally, for all

k

Kâ†’+âˆž
RFk âˆ’âˆ†F Sk
let Î›k =
.
FS

b)
Assumption 4 (Technical assumptions to derive the asymptotic distribution of âˆ†

a) The vectors (Pk , Rk )1â‰¤kâ‰¤K are mutually independent.
b) For all (i, k) âˆˆ I , Dik (1) is non-stochastic.
c) For every k, Nk â‰¤ N + , for some integer N + .
d) sup E |RFk |2+Î´ < +âˆž, for some strictly positive Î´ .


kâˆˆNâˆ—

K
1
e) The following sequences have nite limits when K â†’ +âˆž: i) K1 K
k=1 E (RFk ), ii) K
k=1 E (F Sk ),

1 PK
1 PK
1 PK
1 PK
iii) K k=1 V (RFk ), iv) K k=1 V (F Sk ), v) K k=1 E (RFk F Sk ), vi) K k=1 E |RFk âˆ’ E(RFk )|2+Î´ ,


P
PK
2+Î´ , and viii) 1
2+Î´ .
vii) K1 K
E
|Î›
âˆ’
E(Î›
)|
k
k
k=1 E |F Sk âˆ’ E(F Sk )|
k=1
K

P

P

Typically, the lotteries determining applicants' ranks are independent across waitlists, so by
design the vectors

(Rk )1â‰¤kâ‰¤K

are independent, and

(Rk )1â‰¤kâ‰¤K

is independent of

Then, point a) of Assumption 4 only requires that the vectors

(Pk )1â‰¤kâ‰¤K

(Pk )1â‰¤kâ‰¤K .

be independent.

This is often plausible, for instance when the waitlists correspond to dierent schools.
Point b) requires that whether an applicant is a taker or a non-taker be non-stochastic, a
commonly-made assumption in the randomization-inference literature with imperfect compliance (see, e.g., Imbens & Rosenbaum, 2005).
of

âˆ†K

is non-stochastic, so it follows from Lemma 3.1 that

âˆš

the asymptotic normality of
the linearization of a ratio.
get parameter

1
Tk

Under this assumption, the denominator

âˆ†K

b âˆ’ âˆ†K )
K(âˆ†

âˆ†K =

P
1/K K
E(RFk )
Pk=1
. Then,
1/K K
k=1 E(F Sk )

follows from the central limit theorem and from

Theorem 3.1 still holds without point b), provided the tar-

is replaced by


Ëœ K = E PK
âˆ†
k=1

Tk
LAT Ek
k=1 E(Tk )

PK



,

where

LAT Ek =

P

i:Dik (1)=1 [Yik (1) âˆ’ Yik (0)] is the LATE in waitlist k . Indeed, it follows from Lemma 3.1
PK
E(RFk )
Ëœ K = 1/K Pk=1
that âˆ†
even if point b) fails. Overall, point b) of Assumption 4 is not
1/K K
k=1 E(F Sk )

4

crucially important for Theorem 3.1 to hold, but it simplies the target parameter.

Point c) requires that the number of applicants per waitlist be uniformly bounded by some
constant

4

N +.

Points d) and e) are technical conditions ensuring we can apply Liapunov's

Theorem 3.1 also holds (with âˆ†, the limit of âˆ†K , as the target parameter) if point b) is replaced by the
8

(RFk )kâˆˆNâˆ— , (F Sk )kâˆˆNâˆ— , and (Î›k )kâˆˆNâˆ— , and the weak law of large


2
2
numbers in Gut (1992) to (RFk )kâˆˆNâˆ— , (F Sk )kâˆˆNâˆ— , RFk
, and F Sk
. d) for instance
âˆ—
kâˆˆN
kâˆˆNâˆ—
holds if the potential outcomes Yik (0) and Yik (1) have a bounded support.

 P
2 
K
1 PK
1
1 PK
2
2
2
Let Ïƒ =
lim
,
k=1 V (Î›k ), Ïƒ+ = lim
k=1 E(Î›k ) âˆ’ K
k=1 E (Î›k )
Kâ†’+âˆž K
Kâ†’+âˆž K


2
PK
b
1 PK b
2 = 1
k âˆ’âˆ†F Sk
b k = RF
b
, and Ïƒ
b+
.
Î›
1 PK
k=1 Î›k âˆ’ K
j=1 Î›j
K
central limit theorem to

K

k=1

F Sk

Theorem 3.1 If Assumptions 1-4 hold,
Theorem 3.1 implies that

âˆš




d
b âˆ’ âˆ†K âˆ’â†’
N 0, Ïƒ 2
K âˆ†

and Ïƒb+2 âˆ’â†’ Ïƒ+2 â‰¥ Ïƒ2 .

b is an asymptotically normal estimator of âˆ†K
âˆ†

p

when the number of

waitlists goes to innity. As is usually the case for estimators constructed using independent
but not identically distributed random variables (see e.g. Liu & Singh, 1995), the asymptotic
variance

Ïƒ2

of

b
âˆ†

can only be conservatively estimated: we provide a consistent estimator of

2 , an upper bound of
Ïƒ+
intervals for

âˆ†K . 5

Ïƒ2.

That estimator can then be used to build conservative condence

When all the

Î›k

have the same expectation, something that for instance

happens when all waitlists have the same number of applicants, the same expectation of the
proportion of takers, and the same expectations of takers' and non takers' potential outcomes,

2 = Ïƒ2
Ïƒ+

so those condence intervals are exact. Finally, in simulations shown in Section 3.4

of the Web appendix, we nd that the asymptotic distribution in Theorem 3.1 approximates
the distribution of

b
âˆ†

well if 20 waitlists or more are used in the analysis. This suggests that

articles using more than 20 waitlists may rely on Theorem 3.1 for inference, while articles
using less than 20 waitlists may not.

3.3 Comparison with the Ever Oer and Initial Oer estimators
3.3.1 Comparison with the Ever Oer estimator
Î²bFEE be the coecient of Dik in a
using Zik as the instrument for Dik .

Let

2SLS regression of
We refer to

Î²bFEE

Yik

on

Dik

and waitlist xed eects,

as the EO estimator. The derivation

of its limit relies on Assumption 6, another technical assumption, that is stated in the proofs.

following conditions:
âˆš
K
âˆš
K

!
K
K
1 X
1 X
E (RFk ) âˆ’ lim
E (RFk )
âˆ’â†’ 0
Kâ†’+âˆž K
Kâ†’+âˆž
K
k=1
k=1
!
K
K
1 X
1 X
E (F Sk ) âˆ’ lim
E (F Sk )
âˆ’â†’ 0.
Kâ†’+âˆž K
Kâ†’+âˆž
K
k=1

k=1

These two conditions automatically hold if E (RFk ) and E (F Sk ) are the same in every waitlist. But they can
also hold with heterogeneous waitlists. For instance, they hold if the sequences (E (RFk ))kâˆˆNâˆ— and E (F Sk )kâˆˆNâˆ—
are periodic, which corresponds to an asymptotic where the sample grows by duplicating the original sample.
5
Conservative variance estimators also arise in other articles studying treatment eect estimation in randomized experiments (see e.g. Neyman, 1923).

9

Assumption 6 ensures that the limits in the denition of

wk

and

B

below exist. Let



N +1
Sk Nk âˆ’Sk T k+1
k

Nk

wk =

ï£«
lim 1
Kâ†’+âˆž K

PK

lim 1
Kâ†’+âˆž K

PK

j=1 E


ï£¶,
N +1
Sj Nj âˆ’Sj T j+1
j

ï£­

k=1 E

Nj

ï£¸



N +1
Sk Nk âˆ’Tk T k+1

h

k

Nk

1
Tk

P

i:Dik (1)=1 Yik (0)

B=
lim 1
Kâ†’+âˆž K

âˆ’

1
Nk âˆ’Tk

P

i:Dik (1)=0 Yik (0)

!
i
.


!
N +1
Sk Nk âˆ’Sk T k+1

PK

k=1 E

k

Nk

Theorem 3.2 If Assumptions 1-4 and 6 hold,
Î²bFEE

ï£«
K
X
1
1
p
E ï£­ wk
âˆ’â†’ lim
Kâ†’+âˆž K
Tk
k=1

Under Assumptions 1-4 and 6,

Î²bFEE

ï£¶
X

[Yik (1) âˆ’ Yik (0)]ï£¸ + B.

(2)

i:Dik (1)=1

converges towards the sum of two terms. The rst is a

weighted average of the LATEs of takers in each waitlist. If those LATEs vary across waitlists,
this weighted average is not equal to the LATE of all takers, because it overrepresents waitlists

6 The second term,

with a ratio of seats to takers closer to 1/2.

B , is a bias term.

As explained

in Section 2, this bias arises from the endogenous stopping of oers in each waitlist, and from
the waitlist xed eects.
We start by performing comparative statics on

|B|,

assuming that waitlists are homogeneous:

N0 , T0 , S0 , and âˆ†Y (0) such that for all k , Nk = N0 , Tk = T0 , Sk = S0 ,
i
P
1
Y
(0)
âˆ’
Y
(0)
= âˆ†Y (0) . Then,
i:Dik (1)=1 ik
i:Dik (1)=0 ik
Nk âˆ’Tk

there exist real numbers
and

E

h

1
Tk

P

|B| =

1 âˆ’ t0
|âˆ†
|,
1 âˆ’ s0 + N0 (t0 âˆ’ s0 ) Y (0)

(3)

where t0

= T0 /N0 and s0 = S0 /N0 respectively denote the proportion of takers and the ratio of
7
seats to applicants in the waitlist. The right hand side of (3) is decreasing in N0 , decreasing
8
9
in t0 , increasing in s0 , and increasing in âˆ†Y (0) .
(S0a , S0b ) âˆˆ {2..T0 âˆ’ 1}2 , let
i
P
1
i:Dik (1)=1 Yik (0) âˆ’ Nk âˆ’Tk
i:Dik (1)=0 Yik (0) .

Then, we study how waitlists' heterogeneity aects

(T0a , T0b ) âˆˆ {3..N0 }2 ,

and let

âˆ†Y (0),k = E

h

1
Tk

|B|.

Let

P

The three following results hold:



Nk , Tk , âˆ†Y (0),k = N0 , T0 , âˆ†Y (0) for all k , |B| is larger if Î±% of the waitlists have
S0a seats and (1 âˆ’ Î±)% have S0b seats than if all of them have Î±S0a + (1 âˆ’ Î±)S0b seats.

1. If

6



N +1
Sk Nk âˆ’Sk k









Tk +1
This can be seen from the fact that
= Tk STkk 1 âˆ’ (Tk +1)NSkk/(Nk +1) â‰ˆ Tk STkk 1 âˆ’ STkk .
Nk
7
This remains true if the proportion of takers and the ratio of seats to applicants vary across waitlists.
8
This remains true if the number of applicants and the ratio of seats to applicants vary across waitlists.
9
This remains true if the number of applicants and the proportion of takers vary across waitlists.

10



Nk , Sk , âˆ†Y (0),k = N0 , S0 , âˆ†Y (0) for all k , |B| is larger if Î±% of the waitlists have
T0a takers and (1 âˆ’ Î±)% have T0b takers than if all of them have Î±T0a + (1 âˆ’ Î±)T0b takers.



Tk Sk
If
,
,
âˆ†
= t0 , s0 , âˆ†Y (0) for all k , |B| is larger if Î±% of the waitlists have N0a
Y
(0),k
Nk Nk

2. If

3.

applicants and
Overall,

|B|

(1 âˆ’ Î±)% have N0b

applicants than if all have

Î±N0a + (1 âˆ’ Î±)N0b

applicants.

seems to be higher when waitlists have heterogeneous numbers of applicants,

takers, and seats. The impact of waitlists' heterogeneity on





Nk , Sk , âˆ†Y (0),k = 40, 20, âˆ†Y (0) , |B| is 17.1%
50% have 35 takers than if all have 30 takers.

larger if

|B|

50%

can be large. For instance, if

of waitlists have

25

takers and

3.3.2 Comparison with the Initial Oer estimator
0 = 1{R â‰¤ S } be an indicator for applicants in the initial round of oers, the so-called
Zik
ik
k
PK
Nk
Nk
N âˆ’S
S
0
I
0
initial-oer instrument. Let S =
k=1 Sk . Let wik = Zik Ã— N Ã— Sk + (1 âˆ’ Zik ) Ã— N Ã— Nk âˆ’Sk
bI be the coecient of Dik in
be the propensity score weights attached to initial oers. Let Î²
PS
0
I
a 2SLS regression of Yik on Dik , using Zik as the instrument, and weighted by wik . We call
Î²bPI S the IO estimator.

âˆš  I
K Î²bP S âˆ’ âˆ†K
Under Assumptions 1-2 and a technical condition similar to Assumption 4,
0
converges towards a normal distribution. Contrary to Zik , Zik is only a function of applicants'
Let

random numbers and of the number of seats in their waitlist. Thus, it satises the random
instrument assumption in Imbens & Angrist (1994). Under Assumption 1, it also satises the
monotonicity condition therein. Then, one can show that

Î²bPI S

is an asymptotically normal

estimator of the LATE of applicants complying with an initial oer. As those are a random
subset of the takers, this LATE is equal to
However, using

Î²bPI S

3.3 below. For every

âˆ†K .

b may result in a large loss
âˆ†
Dk = (D1k (1), ..., DNk k (1)).

instead of

k,

let

of precision, as shown in Theorem

b and Î²bI )
Assumption 5 (Assumptions to compare the asymptotic variances of âˆ†
PS

a) For every (i, k) 6= (i0 , k0 ) âˆˆ I 2 , cov (Yik (0), Yi0 k0 (0)|(Dk , Rk )1â‰¤kâ‰¤K ) = 0.
b) For every (i, k) âˆˆ I , V (Yik (0)|(Dk , Rk )1â‰¤kâ‰¤K ) = ÏƒY2 (0) .
c) For every k âˆˆ {1..K}, for every i âˆˆ {1..Nk }, E (Yik (0)|(Dk , Rk )1â‰¤kâ‰¤K ) = Âµk .
d) For every (i, k) âˆˆ I , Yik (1) âˆ’ Yik (0) = Ï„ .
e) For every k âˆˆ {1..K}, Nk = N0 , Sk = S0 , Tk = T0 , for some integers N0 , S0 , and T0 .
f) S0 (N0 âˆ’ S0 ) âˆ’ N0 (N0 âˆ’ T0 ) > 0.

11

Point a) of Assumption 5 requires that the potential outcomes

Yik (0)

be uncorrelated across

applicants, point b) requires that they be homoskedastic, and point c) requires that in each
waitlist,

E (Yik (0)|(Dk , Rk )1â‰¤kâ‰¤K ) be constant.

Point d) requires that the treatment eect be

constant. Point e) requires that all waitlists have the same number of applicants, takers, and
seats. Point f ) ensures that the denominator of the IO estimator diers from 0 with probability
1. The conditions in Assumption 5 help simplify the formulas of

 
b
V âˆ†

and



V Î²bPI S ,

thus

ensuring that these variances can be compared analytically. Some of these conditions may not
be plausible in practice. For instance, point c) fails if the expected value of

Yik (0) diers across

takers and non takers. However, in simulations shown in Section 3.2 of the Web appendix, we
nd that the variance formulas derived in Theorem 3.3 still provide good approximations of

 
b
V âˆ†

and



V Î²bPI S

when points c), d), and f ) of Assumption 5 are violated.

Theorem 3.3
a) If Assumptions 1-4 and a)-e) of Assumption 5 hold,

âˆš
1
+ 1
b âˆ’ âˆ†K ) â‰¤ Ïƒ 2 S0 âˆ’1 T T0 âˆ’S0 .
K(âˆ†
lim sup V
Y (0)
0
Kâ†’+âˆž

N0

b) If Assumptions 1-5 hold, lim V

âˆš

Kâ†’+âˆž


1
1
+ N âˆ’S
0
20 .
K(Î²bPI S âˆ’ âˆ†K ) = ÏƒY2 (0) S0T âˆ’S
0
0
N0 âˆ’S0

Point a) of Theorem 3.3 gives an upper bound of the limsup of
point b) gives the limit of
that

0<

T0
N0

â‰¤ 1âˆ’

1
S0

V

<1

âˆš

K(Î²bPI S


âˆ’ âˆ†K ) .

V

âˆš


b âˆ’ âˆ†K ) ,10
K(âˆ†

while

In order to compare these parameters, note

is a sucient condition to have

condition usually holds in practice. For instance, if

T0
N0

1
1
+ T âˆ’S
S0 âˆ’1
0
0
T0
N0

= 0.75,

â‰¤

1
1
+ N âˆ’S
S0
0

0
T0 âˆ’S0 2
N0 âˆ’S0

. This

the condition will hold as soon

as there are more than 4 seats per waitlist. Then, the upper bound in point a) is lower than
the limit of

V

âˆš


K(Î²bPI S âˆ’ âˆ†K ) .

In practice, using the IO rather than the DREO estimator

can lead to large eciency losses.

For instance, if

N0 = 40, T0 = 30,

and

S0 = 20,

the

asymptotic variance of the IO estimator is 1.97 times larger than that of the DREO one.

4 Application to Blattman & Annan (2016)
After the second Liberian civil war, some ex-ghters started engaging in illegal activities, and
working abroad as mercenaries. Blattman & Annan (2016)

11 study the eect of an agricultural

training on their employment and on their social networks. By improving their labor market

10

Under technical conditions, for instance if one assumes that the potential outcomes have a bounded support,
âˆš
2
b
it follows from
âˆš Theorem 2.20
 in Van der Vaart (2000) and Theorem 3.1 that K(âˆ† âˆ’ âˆ†K ) converges in L ,
2
b
b
K(âˆ† âˆ’ âˆ†K ) is actually a simple limit, and it is equal to Ïƒ , the asymptotic variance of âˆ†.
so lim supV
Kâ†’+âˆž

11

Blattman & Annan (2016) is one of the few articles in our survey in Section 1 of the Web appendix whose
data is not proprietary.

12

opportunities, the program hoped to reduce their interest in illegal and mercenary activities,
and to sever their relationships with other ex-combatants.

To allocate the treatment, the

authors divided applicants into 70 waitlists, according to the training site they applied for,
their former military rank, and their community.

In each waitlist, they randomly ranked

applicants, and oers were made following that ranking until the seats available were lled.
Blattman & Annan (2016) estimate the training's eect on 62 outcomes, that are either
applicants' answers to survey questions, or indexes averaging their answers to several related
questions.

To preserve space, we only consider the main outcomes.

Here are the rules we

used to make our selection: we chose indexes rather than questions averaged into an index;
among questions not averaged into an index, we discarded those asking applicants to give a
subjective opinion; nally, we discarded a few measures the authors did not comment on in
the paper. We end up with four measures of employment, one measure of applicants' interest
in working as mercenaries, and ve measures of their social network.
For each outcome, Table 3 below shows the EO estimator computed by the authors, and
the DREO estimator computed with the same controls as those used by the authors.
estimate of

âˆš

Ïƒ
b+ / K âˆ’ 1

13

is shown next to each DREO estimator.

12 An

In Theorem 2.1 in the

Web appendix, we derive the asymptotic distribution of the EO estimator. Accordingly, an
estimate of

âˆš
2 / K âˆ’ 1,
Ïƒ
bE,+

dened in Section 2.1 of the Web appendix, is shown next to each

EO estimator. The table then shows the p-value of a t-test that the EO and DREO estimators
are equal, also computed following Theorem 2.1 in the Web appendix. Finally, the table shows
the estimated dierence between the mean of

âˆ†Y (0) .

Yik (0)

among non-takers and takers, denoted

The EO and DREO estimators are close for all employment outcomes, but they

signicantly dier for three of the other outcomes. For applicants' interest in mercenary work,
the DREO estimator is 51.0% larger in absolute value than the EO one, and it is statistically
signicant while the EO estimator is only marginally signicant; for applicants' relations with
their ex-commanders, the DREO estimator is 47.4% larger, and it is statistically signicant
while the EO estimator is not; for applicants' social network quality, the DREO estimator is
three times larger, but none of the two estimators is signicant. For the rst two outcomes,
the estimated dierence between the mean of

Yik (0)

of takers and non-takers is large (30.7%

and 25.1% of the standard deviation of these variables, respectively), which may explain why
the EO and DREO estimators dier.

12

The DREO estimator with controls is dened in Section 2.4 of the Web Appendix.
To account for the controls included in the estimation, Yik and Dik are regressed on the controls, and then
the residuals from those two regressions are used instead of Yik and Dik in the computation of Ïƒb+ .
13

13

Table 3: Estimators of the LATE in Blattman & Annan (2016)

EO (s.e.)

DREO (s.e.)

EO=DREO

âˆ†Y (0)

Works in agriculture

0.155 (0.037)

0.167 (0.037)

0.214

0.020

Hours illegal work

-3.697 (1.822)

-3.188 (1.614)

0.183

-2.807

Hours farming work

4.090 (1.511)

4.319 (1.472)

0.468

3.070

Income index

0.157 (0.075)

0.169 (0.069)

0.400

-0.087

Interest mercenary work

-0.239 (0.140)

-0.361 (0.155)

0.010

0.307

Relations ex-combatants

0.073 (0.091)

0.050 (0.097)

0.388

-0.079

Relations ex-commanders

-0.154 (0.113)

-0.227 (0.109)

0.011

0.251

Social network quality

0.027 (0.068)

0.082 (0.068)

0.013

-0.041

Social support

0.188 (0.091)

0.161 (0.089)

0.166

-0.165

Relationships families

0.133 (0.075)

0.161 (0.079)

0.205

-0.059

1,025

1,016

N

Notes.

Columns 2 and 3 show the EO and DREO estimators in Blattman & Annan (2016), for the outcome
variables in Column 1, and with the same controls as in Blattman & Annan (2016). The EO estimators are
computed using all the waitlists, while the DREO estimators are computed excluding two waitlists that had
âˆš
less than two seats. An estimate of Ïƒb+ / K âˆ’ 1 is shown next to each DREO estimator, between parentheses.
âˆš
2
/ K âˆ’ 1 (see Section 2.1 of the Web appendix) is shown next to each EO estimator,
An estimate of ÏƒbE,+
between parentheses. Column 4 shows the p-value of a t-test that the EO and DREO estimators are equal,
where we follow Theorem 2.1 in the Web appendix to compute the standard error of the dierence between
the two estimators. Column 5 shows the estimated dierence between the mean of Yik (0) among takers and
non-takers.

5 Conclusion
When the seats available for a treatment are allocated using randomized waitlists, we show
that applicants getting and not getting an oer are not statistically comparable. Accordingly,
a commonly used estimator of the treatment eect, the ever-oer estimator, is inconsistent
when the number of waitlists goes to innity.

We propose a new estimator, the doubly-

reweighted ever-oer (DREO) estimator, and we show that it is consistent and asymptotically
normal.

Finally, we show that the DREO estimator is often more ecient than another

consistent estimator, the initial-oer estimator. Overall, we recommend that practitioners use
the DREO estimator when they analyze randomized waitlists.

14

References
Abadie, A., Angrist, J. & Imbens, G. (2002), `Instrumental variables estimates of the eect of
subsidized training on the quantiles of trainee earnings',

Econometrica 70(1), 91117.

Angrist, J. D., Imbens, G. W. & Rubin, D. B. (1996), `Identication of causal eects using
instrumental variables',

Journal of the American Statistical Association 91(434), pp. 444

455.
Angrist, J. D. & Pischke, J.-S. (2008),

panion, Princeton university press.

Mostly harmless econometrics: An empiricist's com-

Behaghel, L., de Chaisemartin, C. & Gurgand, M. (2017), `Ready for boarding? the eects
of a boarding school for disadvantaged students',

Economics 9(1), 140164.
Billingsley, P. (1986),

American Economic Journal: Applied

Probability and measure, 2nd edn, John Wiley & Sons.

Blattman, C. & Annan, J. (2016), `Can employment reduce lawlessness and rebellion?
eld experiment with high-risk men in a fragile state',

110(1), 117.

a

American Political Science Review

CrÃ©pon, B., Devoto, F., Duo, E. & ParientÃ©, W. (2015), `Estimating the impact of microcredit
on those who take it up: Evidence from a randomized experiment in morocco',

Economic Journal: Applied Economics 7(1), 123150.

American

de Chaisemartin, C. & D'HaultfÃ·uille, X. (2018), `Fuzzy dierences-in-dierences',

view of Economic Studies 85(2), 9991028.

Gut, A. (1992), `The weak law of large numbers for arrays',

14(1), 4952.

The Re-

Statistics & probability letters

Imbens, G. W. & Angrist, J. D. (1994), `Identication and estimation of local average treatment eects',

Econometrica 62(2), pp. 467475.

Imbens, G. W. & Rosenbaum, P. R. (2005), `Robust, accurate condence intervals with a
weak instrument: quarter of birth and education',

Series A (Statistics in Society) 168(1), 109126.

Journal of the Royal Statistical Society:

Liu, R. Y. & Singh, K. (1995), `Using iid bootstrap inference for general non-iid models',

Journal of statistical planning and inference 43(1-2), 6775.

Neyman, J. (1923), `On the application of probability theory to agricultural experiments. essay
on principles. section 9'. translated in Statistical Science 5(4), 465-472, 1990.
Van der Vaart, A. W. (2000),

Asymptotic statistics, Vol. 3, Cambridge university press.
15

A Proofs
The next lemma shows that the expectation of the average of any function of potential treatments and outcomes is the same among

âˆ€(i, k) âˆˆ I ,

not getting an oer.

let

Pik

wik -reweighted applicants
= (Dik (1), Yik (0), Yik (1)).

getting an oer and those

Lemma A.1 If Assumptions 1-3 hold, then âˆ€k âˆˆ {1..K} and for any function Ï† : R3 7â†’ R,
ï£«

ï£¶
ï£¶
ï£«
Nk
X
X
1
1
1 X
Eï£­
wik Ï† (Pik ) Pk ï£¸ = E ï£­
Ï† (Pik ) Pk ï£¸ =
Ï† (Pik ) .
Lk âˆ’ 1
Nk âˆ’ Lk
Nk
i:Zik =1

i=1

i:Zik =0

Proof of Lemma A.1
We start by showing that

ï£«
Eï£­

ï£¶

1
Lk âˆ’ 1

X
i:Zik =1

First, we show that (4) holds when

Nk
1 X
ï£¸
Ï† (Pik ) .
wik Ï† (Pik ) Pk =
Nk

Pk

(4)

i=1

is such that

ï£«

ï£¶

Eï£­

X
1
wik Ï† (Pik ) Pk ï£¸
Lk âˆ’ 1

Tk < Nk .

Then, we have

i:Zik =1

=

=

=

=

=

=

=

Nk
X

!

Dik (1)
1âˆ’
Ï†(Pik )1{Rik â‰¤ Lk } Pk
E
Sk
i=1



Nk 
X
1
Dik (1)
Ï†(Pik )E
1{Rik â‰¤ Lk } Pk
1âˆ’
Sk
Lk âˆ’ 1
i=1

Nk âˆ’T
Nk 
k +Sk
X
X
Dik (1)
1
1âˆ’
Ï†(Pik )
P (Lk = l|Pk )
E (1{Rik â‰¤ l}| Lk = l, Pk )
Sk
lâˆ’1
i=1
l=Sk
 Nk âˆ’l 

lâˆ’1
Nk âˆ’T
Nk 
k +Sk
X
X
Dik (1)
1
Sk âˆ’1 Tk âˆ’Sk
1âˆ’
Ï†(Pik )
E (1{Rik â‰¤ l}| Lk = l, Pk )

N
k
Sk
lâˆ’1
T
i=1
l=Sk
k
 Nk âˆ’l 




lâˆ’1
N
N
âˆ’T
+S
k
k
k
k
X
X
Dik (1)
1
Sk
l âˆ’ Sk
Sk âˆ’1 Tk âˆ’Sk
1âˆ’
Ï†(Pik )
D
(1)
+
(1
âˆ’
D
(1))

ik
ik
Nk
Sk
lâˆ’1
Tk
Nk âˆ’ Tk
Tk
i=1
l=Sk
ï£«
 Nk âˆ’l  S âˆ’1
 Nk âˆ’l  lâˆ’S ï£¶
lâˆ’1
lâˆ’1
Nk
Nk âˆ’T
Nk âˆ’T
k
k
k +Sk
k +Sk
X
X
X
1
Sk âˆ’1 Tk âˆ’Sk lâˆ’1
Sk âˆ’1 Tk âˆ’Sk lâˆ’1 ï£¸
Ï†(Pik ) ï£­Dik (1)
+
(1
âˆ’
D
(1))


ik
Nk Tk
Nk Nk âˆ’Tk
Nk
Tk Nk
Tk
Nk
i=1
l=Sk
l=Sk +1
ï£«



ï£¶
Nk âˆ’1âˆ’l
lâˆ’1
Nk âˆ’1âˆ’l
lâˆ’1
Nk
Nk âˆ’TX
Nk âˆ’1âˆ’T
k +Sk
k +Sk âˆ’1
X
X
1
Sk âˆ’2
Tk âˆ’Sk
Sk âˆ’1
Tk âˆ’Sk ï£¸
Ï†(Pik ) ï£­Dik (1)
+ (1 âˆ’ Dik (1))


N
âˆ’1
N
âˆ’1
k
k
Nk
T âˆ’1
T
1
Lk âˆ’ 1

i=1

=



l=Sk âˆ’1

k

Nk
1 X
Ï†(Pik ).
Nk

l=Sk

k

(5)

i=1

16

wik , Zik , and Dik . The second equality
Pk , Nk and Sk are non stochastic, and the

The rst equality follows from the denitions of
holds because

Dik (1)

and

Ï†(Pik )

are functions of

conditional expectation is linear. The third follows from the law of iterated expectations, and
the fact that

Lk

is included between

Sk

and

Nk âˆ’ Tk + Sk

under Assumptions 1 and 3.

Lk = l is equivalent to having Sk âˆ’1 takers with Rik â‰¤ lâˆ’1,
 Nk âˆ’l 
= l, and Tk âˆ’ Sk with Rik â‰¥ l + 1. Slâˆ’1
âˆ’1
Tk âˆ’Sk Tk !(Nk âˆ’ Tk )! possible values
k
these constraints. Under Assumption 2, conditional on Pk each of those values

Then, under Assumption 1, having
one with
of

Rk

Rik

satisfy

has a probability

1
Nk ! of being realized. Hence the fourth equality.

Then,

E (1{Rik â‰¤ l}| Lk = l, Pk )

Conditional on

Lk = l, Sk

=

Dik (1)E (1{Rik â‰¤ l}| Lk = l, Dik (1) = 1, Pk \ Dik (1))

+

(1 âˆ’ Dik (1))E (1{Rik â‰¤ l}| Lk = l, Dik (1) = 0, Pk \ Dik (1)) . (6)

Tk

takers out of

satisfy

Rik â‰¤ l,

and Assumption 2 ensures that

each taker has the same probability of satisfying this condition, so

E (1{Rik â‰¤ l}| Lk = l, Dik (1) = 1, Pk \ Dik (1)) =
Similarly, conditional on

Lk = l

and

Tk < Nk , l âˆ’ Sk

non-takers out of

Sk
.
Tk
Nk âˆ’ Tk

(7)

satisfy

Rik â‰¤ l,

and Assumption 2 ensures that each has the same probability of satisfying this condition, so

E (1{Rik â‰¤ l}| Lk = l, Dik (1) = 0, Pk \ Dik (1)) =

l âˆ’ Sk
.
Nk âˆ’ Tk

(8)

Plugging (7) and (8) into (6) yields the fth equality. The sixth and seventh equalities follow
after some algebra.

Tk < Nk and
1 â‰¤ Sk â‰¤ Tk â‰¤ Nk âˆ’ 1, thus

Nk âˆ’1

Then, we prove the eighth equality. Before that, note that
that

1 â‰¤ Sk âˆ’ 1 â‰¤ Tk âˆ’ 1 â‰¤ Nk âˆ’ 1

and

quantities that follow are well-dened.

There are

Tk âˆ’1

Assumption 3 ensure
ensuring that all the

Tk âˆ’ 1 units
between Sk âˆ’ 1 and
 Nk âˆ’1âˆ’l
lâˆ’1

ways of distributing

Nk âˆ’ 1 ranks. The rank of the Sk âˆ’ 1th unit must be included
Nk âˆ’ Tk + Sk âˆ’ 1, and for every l âˆˆ {Sk âˆ’ 1..Nk âˆ’ Tk + Sk âˆ’ 1}, there are Sk âˆ’2 Tk âˆ’Sk
ways of distributing those Tk âˆ’ 1 units while having that the Sk âˆ’ 1th unit is at the lth rank.
over

Therefore,

Nk âˆ’TX
k +Sk âˆ’1 
l=Sk âˆ’1


 

lâˆ’1
Nk âˆ’ 1 âˆ’ l
Nk âˆ’ 1
=
.
Sk âˆ’ 2
Tk âˆ’ Sk
Tk âˆ’ 1

(9)

Tk units over Nk âˆ’ 1 ranks, the rank of the Sk th unit must lie
 Nk âˆ’1âˆ’l
lâˆ’1
between Sk and Nk âˆ’1âˆ’Tk +Sk . For every l âˆˆ {Sk ..Nk âˆ’1âˆ’Tk +Sk }, there are
Sk âˆ’1
Tk âˆ’Sk
ways of distributing those Tk units while having the Sk th unit at the lth rank. Thus,
Similarly, when distributing

Nk âˆ’1âˆ’T
Xk +Sk
l=Sk




 

lâˆ’1
Nk âˆ’ 1 âˆ’ l
Nk âˆ’ 1
=
.
Sk âˆ’ 1
Tk âˆ’ Sk
Tk
17

(10)

The eighth equality follows from (9) and (10). This concludes the proof of (5).
Second, we show that (4) holds when

Pk

ï£«

Tk = Nk .

is such that

ï£¶

Nk
X

X
1
Eï£­
wik Ï†(Pik ) Pk ï£¸ = E
Lk âˆ’ 1

i=1

i:Zik =1

=

Nk
X

1
Ï†(Pik ) 1{Rik â‰¤ Sk } Pk
Sk

Ï†(Pik )

i=1

=

Then, we have

!

1
E (1{Rik â‰¤ Sk }| Pk )
Sk

Nk
1 X
Ï†(Pik ).
Nk

(11)

i=1

The rst equality follows from the denition of
The second equality holds because

Ï†(Pik )

wik

and from the fact that if

Tk = Nk , Lk = Sk .

Pk , Nk

are non stochastic,

is a function of

and

Sk

and the conditional expectation is linear. The third equality follows from the fact that under
Assumption 2, if
having

Rik â‰¤ Sk .

Tk = Nk

then conditional on

Pk

each applicant has a probability

Sk
Nk of

This proves (11). (5) and (11) prove (4).

We then show that

ï£«
Eï£­

ï£¶

1
Nk âˆ’ Lk

X
i:Zik =0

First, we show that (12) holds when

E

=

=

=

=

=

Nk
X

1
Nk âˆ’ Lk

(12)

i=1

is such that

Tk < Nk .

Then, we have

!
X

Ï† (Pik ) Pk

i:Zik =0


1
1{Rik > Lk } Pk
Ï†(Pik )E
Nk âˆ’ Lk
i=1
 Nk âˆ’l 
lâˆ’1
Nk
Nk âˆ’T
k +Sk
X
X
1
Sk âˆ’1 Tk âˆ’Sk
Ï†(Pik )
E (1{Rik > l}| Lk = l, Pk )

Nk
N
âˆ’l
k
Tk
i=1
l=Sk
 Nk âˆ’l 


lâˆ’1
Nk
Nk âˆ’T
k +Sk
X
X
1
Tk âˆ’ Sk
Nk âˆ’ Tk âˆ’ l + Sk
Sk âˆ’1 Tk âˆ’Sk
Ï†(Pik )
D
(1)
+
(1
âˆ’
D
(1))

ik
ik
Nk
Nk âˆ’ l
Tk
Nk âˆ’ Tk
Tk
i=1
l=Sk


 Nk âˆ’l  Nk âˆ’Tk âˆ’l+Sk !
lâˆ’1
Nk âˆ’l Tk âˆ’Sk
Nk
Nk âˆ’T
Nk âˆ’1âˆ’T
k +Sk
X
Xk +Sk Slâˆ’1
1 X
Sk âˆ’1 Tk âˆ’Sk Nk âˆ’l
âˆ’1
Tk âˆ’Sk
Nk âˆ’l
k
Ï†(Pik ) Dik (1)
+ (1 âˆ’ Dik (1))


N k Tk
Nk Nk âˆ’Tk
Nk i=1
Tk Nk
Tk
Nk
l=Sk
l=Sk
!




lâˆ’1
N
âˆ’1âˆ’l
lâˆ’1
N
âˆ’1âˆ’l
Nk
Nk âˆ’T
Nk âˆ’1âˆ’T
k
k +Sk
X
Xk +Sk S âˆ’1 Tk âˆ’S
1 X
Sk âˆ’1 Tk âˆ’1âˆ’Sk
k
k
Ï†(Pik ) Dik (1)
+
(1
âˆ’
D
(1))

 k
ik
Nk âˆ’1
Nk âˆ’1
Nk i=1
T âˆ’1
T


l=Sk

=

Pk

Nk
1 X
ï£¸
Ï† (Pik ) Pk =
Ï† (Pik ) .
Nk

l=Sk

k

k

Nk
1 X
Ï†(Pik ).
Nk i=1

(13)

This derivation follows from arguments similar to those used when deriving (5).
prove the last equality.

Note that Assumption 3 ensures that

18

We only

1 â‰¤ Sk â‰¤ Tk âˆ’ 1 â‰¤ Nk âˆ’ 1,

thus ensuring that all the quantities that follow are well-dened. There are

Nk âˆ’1
Tk âˆ’1



ways of

Tk âˆ’ 1 units over Nk âˆ’ 1 ranks. The rank of the Sk th unit must be included
 Nk âˆ’1âˆ’l 
lâˆ’1
between Sk and Nk âˆ’ Tk + Sk , and for every l âˆˆ {Sk ..Nk âˆ’ Tk + Sk }, there are
Sk âˆ’1 Tk âˆ’1âˆ’Sk
ways of distributing those Tk âˆ’ 1 units while having that the Sk th unit is at the lth rank.
distributing

Therefore,

Nk âˆ’T
k +Sk
X



l=Sk


 

lâˆ’1
Nk âˆ’ 1 âˆ’ l
Nk âˆ’ 1
=
.
Sk âˆ’ 1 Tk âˆ’ 1 âˆ’ Sk
Tk âˆ’ 1

(14)

The last equality in the derivation of (13) follows from (10) and (14).
Second, we show that (12) holds when

E

1
Nk âˆ’ Lk

!
X

Ï†(Pik ) Pk

i:Zik =0

Pk

is such that

Tk = Nk .

Then, we have

Nk
X

Nk
1
1 X
Ï†(Pik )
Ï†(Pik ). (15)
=
E (1{Rik > Sk }| Pk ) =
Nk âˆ’ Sk
Nk i=1
i=1

This derivation follows from arguments similar to those used when deriving (11). (13) and
(15) prove (12). QED.

Proof of Lemma 3.1
We only prove point a), point b) follows from a similar argument.

ï£¶ï£¶
ï£«
K
X
X
X
1
1
N
1
k ï£­
Yik ï£¸ï£¸
Eï£­
wik Yik âˆ’
K
Lk âˆ’ 1
Nk âˆ’ Lk
N
i:Zik =0
i:Zik =1
k=1
ï£¶ï£¶
ï£« ï£«
ï£¶
ï£«
K
X
X
X
1
Nk ï£­ ï£­ 1
1
=
Yik (0) Pk ï£¸ï£¸
wik Yik (Dik (1)) Pk ï£¸ âˆ’ E ï£­
E E
K
Lk âˆ’ 1
Nk âˆ’ Lk
N
i:Zik =0
i:Zik =1
k=1
!
Nk
K
1 X Nk
1 X
=
E
[Yik (Dik (1)) âˆ’ Yik (0)]
K
Nk
N
i=1
k=1
ï£«
ï£¶
X
1
= Eï£­
[Yik (Dik (1)) âˆ’ Yik (0)]ï£¸ .
N
ï£«

(i,k)âˆˆI

Nk and N
and Dik , from

The rst equality follows from the linearity of the expectation, from the fact
are not stochastic, from point c) of Assumption 1 and the denitions of

Yik

the law of iterated expectations, and from the linearity of the conditional expectation. The
second equality follows from Lemma A.1, with
expectation, and

Ï†(Pik ) = Yik (0)

Ï†(Pik ) = Yik (Dik (1))

for the rst conditional

for the second one. The third equality follows after some

algebra. QED.
The proof of Theorem 3.1 below makes use of the following lemma, where

Op (1)

(resp.

op (1))

stands for a sequence of random variables bounded in probability (resp. converging towards
0 in probability), see, e.g., Van der Vaart (2000).

19

Lemma A.2 Let

and (BK )KâˆˆN be two sequences of real numbers such that for
every K , BK â‰¥ C for some real number C > 0, and BAKK converges towards a nite
limit. Let
âˆš 
b
b
b
(AK )KâˆˆN and (BK )KâˆˆN be two sequences of random variables such that K AK âˆ’ AK =
Op (1)

âˆš

(AK )KâˆˆN

and K BbK âˆ’ BK = Op (1). Then,


âˆš
K



bK
AK
A
âˆ’
bK
BK
B

!

âˆš
=

1
K
BK



AK b
b
(AK âˆ’ AK ) âˆ’
(BK âˆ’ BK ) + oP (1).
BK

Proof of Lemma A.2
âˆš



bK âˆ’ AK = Op (1)
K A

bK âˆ’BK = op (1).
B

âˆš
and



bK âˆ’ BK = Op (1)
K B

imply that

Therefore, with probability approaching one,

bK âˆ’ AK = op (1)
A

and


bK âˆ’ AK , B
bK âˆ’ BK â‰¤
max A


C
2 . Then, Lemma S3 in de Chaisemartin & D'HaultfÃ·uille (2018) implies that with probability
approaching one,

!


bK
âˆš
A
AK
1
A
K
bK âˆ’ AK ) âˆ’
bK âˆ’ BK )
K
âˆ’ K
(A
(B
âˆ’
bK
BK
BK
BK
B


AK
âˆš



2 1+ B
âˆš
K
bK âˆ’ AK ), K(B
bK âˆ’ BK ) max A
bK âˆ’ AK , B
bK âˆ’ BK .
max
K(
A
C2
âˆš

â‰¤

The right hand side of the inequality in the previous display is an
approaching one, the left hand side is bounded by an

op (1),

op (1).

so it is itself an

With probability

op (1).

QED.

Proof of Theorem 3.1
Proof that

âˆš




d
b âˆ’ âˆ†K âˆ’â†’
K âˆ†
N 0, Ïƒ 2

First, notice that

ï£«
âˆ†K

=

=

=

ï£¶

1 ï£­
E
[Yik (1) âˆ’ Yik (0)]ï£¸
T
(i,k):Dik (1)=1
 P

E N1 (i,k)âˆˆI [Yik (Dik (1)) âˆ’ Yik (0)]
1 P
(i,k)âˆˆI Dik (1)
N

 P
E K1 K
RF
k
k=1
 P
.
E K1 K
F
S
k
k=1
X

(16)

The rst equality follows from point b) of Assumption 4. The second equality follows from
some algebra, and from point a) of Assumption 1. The last equality follows from points a)
and b) of Lemma 3.1, point b) of Assumption 4, and the denitions of

20

RFk

and

F Sk .

Then,

K
1 X
RFk âˆ’ E
K

!!
K
1 X
K
RFk
K
k=1
k=1
v
u
PK
K
u1 X
(RF
âˆ’
E
(RF
))
k
k
k=1
t
qP
V (RFk ).
K
K
V
(RF
)
k=1
k
k=1

âˆš

=

(17)

RFk s are independent.
and variance of RFk exist,

Point a) of Assumption 1 and point a) of Assumption 4 ensures that the
Point d) of Assumption 4 ensures that for every
and points e.iii) and e.vi) ensures that

k,

(RFk )kâˆˆNâˆ—

the expectation

satises the Liapunov condition. Then, the

Liapunov central limit theorem (see, e.g., Billingsley, 1986, Theorem 27.3) implies that

Point e.iii) of Assumption 4

PK
(RF âˆ’ E (RFk )) d
k=1
qP k
âˆ’â†’ N (0, 1).
K
V
(RF
)
k
k=1
q P
K
1
ensures that
k=1 V (RFk ) has a nite
K

(18)

limit, denoted

ÏƒRF .

Therefore, combining (17), (18), and the Slutsky lemma,

âˆš
K

Similarly, let

ÏƒF S

K
1 X
RFk âˆ’ E
K
k=1
q P

K
1 X
RFk
K

K
1 X
F Sk âˆ’ E
K

K
1 X
F Sk
K

1
K

be the limit of

âˆš
K

!!!
d

2
âˆ’â†’ N (0, ÏƒRF
).

(19)

k=1

K
k=1 V

k=1

(F Sk ).

One can show that

!!
d

âˆ’â†’ N (0, ÏƒF2 S ).

(20)

k=1

Finally,

âˆš



b âˆ’ âˆ†K
K âˆ†
 P
ï£¶
ï£«
K
PK
1
1
E K k=1 RFk
âˆš
RFk
ï£¸
âˆ’  P
= K ï£­ K1 Pk=1
K
K
1
F
S
k
E
F
S
k=1
K
k
k=1
K
âˆš
= K

K
1 X
RFk âˆ’ E
K

1
PK



E K1 k=1 F Sk
k=1
 P

K
E K1 K
k=1 RFk
1 X


âˆ’
F Sk âˆ’ E
P
K
E K1 K
k=1
k=1 F Sk

âˆš
= K
E
=
E



1
K



1
K

1
PK

FS
PK

k=1 F Sk

k=1 F Sk



âˆš
 K

K
1 X
RFk âˆ’ E
K
k=1

1
K

K
X

K
1 X
RFk
K

!

k=1

K
1 X
F Sk
K

!!ï£¶
ï£¸ + oP (1)

k=1

K
1 X
RFk
K

!
âˆ’âˆ†

k=1

K
1 X
F Sk âˆ’ E
K
k=1

!
(Î›k âˆ’ E (Î›k ))

k=1

21

d

+ oP (1) âˆ’â†’ N (0, Ïƒ 2 ).

K
1 X
F Sk
K
k=1

!!!
+ oP (1)

F Sk
PK

The rst equality follows from the denitions of
The second equality follows from the fact

1
K

E



1
K

RFk and from (16).

 P

K
1
RF
F
S
,
E
,
k
k
k=1
k=1
K
and

1
K

PK

k=1 RFk ,

PK

point b) of Lemma 3.1, point
k=1 F Sk satisfy the assumptions of Lemma A.2.
 Indeed,

1 PK
c) of Assumption 4, and Assumption 3 imply that E
F
S
â‰¥ N3+ > 0. Moreover,
k
 P

 KP k=1 
K
K
1
1
RF
/E
F
S
points e.i) and e.ii) of Assumption 4 imply that E
k
k conk=1
k=1
K
K

and

verges towards a nite limit. Finally, it follows from (19), (20), and the fact that convergence
in distribution implies boundedness in probability, that

âˆš
K
âˆš
K

K
1 X
RFk âˆ’ E
K

K
1 X
RFk
K

1
K

1
K

k=1
K
X

F Sk âˆ’ E

k=1

k=1
K
X

!!
= Op (1)
!!

F Sk

= Op (1).

k=1

(16), points e.i) and e.ii) of Assumption 4, and (20) ensure that

ï£«
E



1
K

1
PK

k=1 F Sk

 ï£­âˆ† âˆ’

E



1
K

E



1
K

ï£¶
RF
âˆš
k
k=1
ï£¸ K

PK
k=1 F Sk

PK

K
1 X
F Sk âˆ’ E
K
k=1

K
1 X
F Sk
K

!!
= oP (1),

k=1

hence the third equality. The fourth equality follows from the denition of

Î›k .

The conver-

gence in distribution arrow follows from a reasoning similar to that used to prove (19), and
from the Slutsky lemma and the denition of

Proof that Ïƒb+2

F S.

p

2 â‰¥ Ïƒ2.
âˆ’â†’ Ïƒ+

By point a) of Assumption 1, points a) and d) of Assumption 4, the weak law of large numbers
in Gut (1992), and points e.i) and e.ii) of Assumption 4,

K
1 X
p
RFk âˆ’â†’
K

K
1 X
E (RFk )
Kâ†’+âˆž K

K
1 X
p
F Sk âˆ’â†’
K

K
1 X
lim
E (F Sk ) .
Kâ†’+âˆž K

k=1

k=1

âˆš
Then, the fact that



b âˆ’ âˆ†K
K âˆ†

lim

k=1

(21)

k=1

is asymptotically normal, Equation (16), and points e.i)

and e.ii) of Assumption 4 imply that

p
b âˆ’â†’
âˆ†
âˆ†.

(22)

Then, (21), (22), and the continuous mapping theorem imply that

K
1 Xb
Î›k =
K
k=1

1
1
K

PK

k=1 F Sk

K
K
X
1 X
b 1
RFk âˆ’ âˆ†
F Sk
K
K
k=1

k=1

22

!

p

âˆ’â†’

K
1 X
E (Î›k ) .
Kâ†’+âˆž K

lim

k=1

(23)

Similarly, one can show that

K
1 X b2 p
Î›k âˆ’â†’
K

K

1 X
E Î›2k .
Kâ†’+âˆž K

lim

k=1

(24)

k=1

Then, (23), (24), and the continuous mapping theorem imply that

K
1 X b2
2
Ïƒ
b+ =
Î›k âˆ’
K

K
1 Xb
Î›k
K

k=1

Finally, the convexity of

2
Ïƒ+

â‰¥

x 7â†’ x2

!2

p

2
âˆ’â†’ Ïƒ+
.

(25)

k=1

implies that

1
K

PK

2
k=1 E (Î›k ) â‰¥



1
K

2
,
E
(Î›
)
k
k=1

PK

so

Ïƒ 2 . QED.

Theorem 3.2 relies on Assumption 6 below. Let

ï£¶
ï£«


X
X
1
L
1
k
ï£­
Yik âˆ’
Yik ï£¸ ,
1âˆ’
RFkE
Nk
Lk
Nk âˆ’ Lk
i:Zik =1
i:Zik =0


X
Lk
1
Lk
F SkE = Nk
Dik .
1âˆ’
Nk
Nk Lk
Lk
= Nk
Nk

i:Zik =1

Assumption 6 (Technical assumptions to derive the probability limit of Î²bFEE )
sup E
kâˆˆNâˆ—

|RFkE |1+Î´



< +âˆž

for some strictly positive Î´ ;

1
K

PK



N +1
Sk Nk âˆ’Tk T k+1

1
K

PK



N +1
Sk Nk âˆ’Sk T k+1

k=1 E

k=1 E

k

Nk
k

Nk

h

1
Tk

P

âˆ’

i:Dik (1)=1 Yik (0)

1
K

PK

k=1 E

1
Nk âˆ’Tk

P

P

i:Dik (1)=1 [Yik (1)

âˆ’ Yik (0)]

k

Nk

i:Dik (1)=0 Yik (0)

!
1
Tk


!
N +1
Sk Nk âˆ’Sk T k+1

!
i

,

, and

have nite limits when K â†’ +âˆž.

Proof of Theorem 3.2
First,

E(Lk |Pk ) =

Nk âˆ’T
k +Sk
X

lâˆ’1
Sk âˆ’1



l

Nk
Tk

l=Sk

Nk + 1
=Sk
Tk + 1
=Sk

Nk âˆ’l
Tk âˆ’Sk



Nk âˆ’T
k +Sk
X
l=Sk



l
Sk



Nk +1âˆ’(l+1) 
Tk +1âˆ’(Sk +1)

Nk +1
Tk +1

Nk + 1
.
Tk + 1

(26)

This derivation follows from arguments similar to those used when deriving (5).

23

Then, it follows from the fact that a 2SLS coecient with one endogenous variable and one
instrument is equal to the ratio of the reduced form and rst stage coecients, from Equation
(3.3.7) in Angrist & Pischke (2008), and from the denitions of

Î²bFEE =

1
K
1
K

RFkE

and

F SkE ,

that

PK

E
k=1 RFk
.
PK
E
k=1 F Sk

(27)

k,

E

For every

E RFk
!

 Nk
Nk
Lk X
Lk X
=E
1âˆ’
Yik (Dik (1))1{Rik â‰¤ Lk } âˆ’
Yik (0)(1 âˆ’ 1{Rik â‰¤ Lk })
Nk
Nk
i=1
i=1
!
 Nk

Nk
Lk X
Lk X
Yik (0)(1 âˆ’ E(1{Rik â‰¤ Lk }|Lk , Pk ))
=E
Yik (Dik (1))E(1{Rik â‰¤ Lk }|Lk , Pk ) âˆ’
1âˆ’
Nk
Nk
i=1
i=1
 Nk



Lk âˆ’ Sk
Lk X
Sk
=E
+ (1 âˆ’ Dik (1))
1âˆ’
Yik (Dik (1)) Dik (1)
Nk
Tk
Nk âˆ’ Tk
i=1

!
Nk
Tk âˆ’ Sk
Nk âˆ’ Tk âˆ’ Lk + Sk
Lk X
Yik (0) Dik (1)
+ (1 âˆ’ Dik (1))
âˆ’
Nk
Tk
Nk âˆ’ Tk
i=1
ï£«
X
X
(Nk âˆ’ Lk )Sk 1
Lk (Tk âˆ’ Sk ) 1
=E ï£­
Yik (1) âˆ’
Yik (0)
Nk
Tk
Nk
Tk
i:Dik (1)=1
i:Dik (1)=1
ï£¶
X
(Nk âˆ’ Lk )(Lk âˆ’ Sk ) âˆ’ Lk (Nk âˆ’ Tk âˆ’ Lk + Sk )
1
+
Yik (0)ï£¸
Nk
Nk âˆ’ Tk
i:Dik (1)=0
ï£«
X
(Nk âˆ’ Lk )Sk 1
=E ï£­
[Yik (1) âˆ’ Yik (0)]
Nk
Tk
i:Dik (1)=1
ï£«
ï£¶ï£¶
X
X
Nk Sk âˆ’ Lk Tk ï£­ 1
1
+
Yik (0) âˆ’
Yik (0)ï£¸ï£¸
Nk
Tk
Nk âˆ’ Tk
i:Dik (1)=1
i:Dik (1)=0

ï£« 
k +1
Sk Nk âˆ’ Sk N
X
Tk +1
1
ï£­
=E
[Yik (1) âˆ’ Yik (0)]
Nk
Tk
i:Dik (1)=1

ï£«
ï£¶ï£¶
k +1
Sk Nk âˆ’ Tk N
X
X
Tk +1
1
1
ï£­
+
Yik (0) âˆ’
Yik (0)ï£¸ï£¸ .
(28)
Nk
Tk
Nk âˆ’ Tk
i:Dik (1)=1

i:Dik (1)=0

The rst equality follows from the denition of

RFkE

and some algebra. The second equality

follows from the law of iterated expectations and the linearity of the conditional expectation.
The third equality follows from (7) and (8). The fourth and fth equality follow from some
algebra. The last equality follows from the law of iterated expectations, the linearity of the
conditional expectation, and (26).

24

Similarly, one can show that for every

k,


ï£¶
Nk +1
S
N
âˆ’
S
k
k
k

Tk +1
ï£¸.
E F SkE = E ï£­
Nk
ï£«

(29)

Equations (28) and (29) combined with Assumption 6 imply that

1
K

PK

k=1 E

F SkE



converge towards nite limits when

K â†’ +âˆž.

1
K

PK

k=1 E

RFkE



and

Then, one can use a rea-

soning similar to that used to prove (21) to show that

p
Î²bFEE âˆ’â†’

1
Kâ†’+âˆž K

PK

1
Kâ†’+âˆž K

PK

lim

lim

k=1 E

RFkE

E
k=1 E F Sk


.

(30)

The result follows from plugging (28) and (29) into (30). QED.

Proof of Theorem 3.3
Proof of a)
The organization of the proof is as follows. We use the variance decomposition formula



 
 


b (Dk , Rk )1â‰¤kâ‰¤K ,
b
b (Dk , Rk )1â‰¤kâ‰¤K
+ KV E âˆ†
KV âˆ†
= E KV âˆ†

(31)

and then compute the limsup of the rst term on the right hand side, before showing that the
second term is equal to 0.
Let

=

=

=

=

d
F
S=

1
K

Nk Sk âˆ’1
k=1 N Lk âˆ’1 .

PK



b (Dk , Rk )1â‰¤kâ‰¤K
KV âˆ†
ï£«
ï£¶
ï£«
ï£¶
K
X
X
X
K
Nk ï£­ 1
1
ï£­1
wik (Yik (0) + Ï„ Dik (1)) âˆ’
Yik (0)ï£¸ (Dk , Rk )1â‰¤kâ‰¤K ï£¸
2V
K
L
âˆ’
1
N
âˆ’
Lk
N
d
k
k
F
S
i:Zik =0
i:Zik =1
k=1
ï£«
ï£¶
ï£¶
ï£«
K
X
X
X
1
1
K
1
N
k ï£­
ï£­
wik Yik (0) âˆ’
Yik (0)ï£¸ (Dk , Rk )1â‰¤kâ‰¤K ï£¸
2V
K
Lk âˆ’ 1
Nk âˆ’ Lk
N
d
F
S
i:Zik =1
i:Zik =0
k=1
ï£«
K
X
1 1 X Nk2 ï£­
1
2
wik
V (Yik (0)|(Dk , Rk )1â‰¤kâ‰¤K )
2K
2
2
(L
âˆ’
1)
d
k
FS
i:Zik =1
k=1 N
ï£¶
X
1
+
V (Yik (0)|(Dk , Rk )1â‰¤kâ‰¤K )ï£¸
(Nk âˆ’ Lk )2
i:Zik =0
ï£«
ï£¶
K
2
X
ÏƒY2 (0) 1 X
Nk ï£­
1
1
2
ï£¸
wik
+
2 K
2
2
(L
âˆ’
1)
N
âˆ’
L
d
k
k
k
N
FS
i:Zik =1

k=1

â‰¤

K
ÏƒY2 (0) 1 X
Nk2
2
2
d
F
S K k=1 N



1
1
+
Lk âˆ’ 1 Nk âˆ’ Lk


.

25

(32)

The rst equality follows from the fact that
point d) of Assumption 5.

(Dk , Rk )1â‰¤kâ‰¤K , K1

Nk 1
k=1 N Lk âˆ’1

P

i:Zik =1 wik

(Dk , Rk )1â‰¤kâ‰¤K ,

and from

i:Zik =1 wik Dik (1)Ï„ is a constant. The third equality follows

The fourth equality follows from point b) of Assumption

0 â‰¤ wik â‰¤ 1

The inequality follows from the fact that

P

is a function of

The second equality follows from the fact that conditional on

PK

from point a) of Assumption 5.
5.

d
F
S

implies

2 â‰¤ w ,
0 â‰¤ wik
ik

and

= Lk âˆ’ 1.

Assumption 3 and point c) of Assumption 4 guarantee that for all

Nk2
N

2



1
1
+
Lk âˆ’ 1 Nk âˆ’ Lk




â‰¤2

N+
3

k,

2
.

(33)

Moreover, by point a) of Assumption 4 these random variables are independent, so it follows
from Gut (1992) that




K
1
1
1
1
1 X Nk2
p
+
âˆ’E
+
âˆ’â†’ 0.
2
K
Lk âˆ’ 1 Nk âˆ’ Lk
Lk âˆ’ 1 Nk âˆ’ Lk
k=1 N
Using a reasoning similar to that used in the proof of Lemma A.1, one can show that


E

1
1
+
Lk âˆ’ 1 Nk âˆ’ Lk



Tk
=
Nk



1
1
+
Sk âˆ’ 1 Tk âˆ’ Sk



T0
=
N0



1
1
+
S0 âˆ’ 1 T0 âˆ’ S0


,

where the second equality follows from point e) of Assumption 5. Combining the two preceding
displays,





K
1 X Nk2
1
1
T0
1
1
p
+
âˆ’â†’
+
.
2
K
Lk âˆ’ 1 Nk âˆ’ Lk
N0 S0 âˆ’ 1 T0 âˆ’ S0
N
k=1

(34)

Similarly, one can show that

K
1 X Nk Sk âˆ’ 1 p T0
âˆ’â†’
.
K
Lk âˆ’ 1
N0
N
k=1

(35)

Then, it follows from (34), (35), and the continuous mapping theorem that



K
1
1
ÏƒY2 (0) 1 X
Nk2
1
1
p
S0 âˆ’1 + T0 âˆ’S0
2
+
âˆ’â†’ ÏƒY (0)
.
2
2
T0
Lk âˆ’ 1 Nk âˆ’ Lk
d
F
S K k=1 N
N0
d
F
Sâ‰¥

1
. Combined with
N + âˆ’2

is bounded.

Then, it follows from

Finally, Assumption 3 and point c) of Assumption 4 imply that
(33), this implies that

2
ÏƒY
(0) 1
2
FcS K

Nk2
k=1 N 2

PK



1
Lk âˆ’1

+

1
Nk âˆ’Lk



(36)

Equation (36) and Theorem 2.20 in Van der Vaart (2000) that

lim E

Kâ†’+âˆž


!
K
1
1
ÏƒY2 (0) 1 X
Nk2
1
1
S0 âˆ’1 + T0 âˆ’S0
2
+
= ÏƒY (0)
.
2
2
T0
Lk âˆ’ 1 Nk âˆ’ Lk
d
F
S K k=1 N
N0

(37)

Combined with Equation (32), Equation (37) implies that

1



+ 1
b (Dk , Rk )1â‰¤kâ‰¤K
lim supE KV âˆ†
â‰¤ ÏƒY2 (0) S0 âˆ’1 T0 T0 âˆ’S0 .
Kâ†’+âˆž

N0
26

(38)

Then,


 
b (Dk , Rk )1â‰¤kâ‰¤K
V E âˆ†
= V

= V

Ï„+

âˆ’

K
1 1 X Nk
d
F
S K k=1 N

1
Nk âˆ’ Lk

X

X
1
1
wik (Yik (0) + Ï„ Dik (1)) âˆ’
Lk âˆ’ 1
Nk âˆ’ Lk
i:Zik =1

!!

!
X

Yik (0)

(Dk , Rk )1â‰¤kâ‰¤K

i:Zik =0

X
1
wik E (Yik (0)|(Dk , Rk )1â‰¤kâ‰¤K )
Lk âˆ’ 1
i:Zik =1
!!

E (Yik (0)|(Dk , Rk )1â‰¤kâ‰¤K )

i:Zik =0

!!
X
1
wik âˆ’ 1
Lk âˆ’ 1

K
1 1 X Nk
Âµk
d
F
S K k=1 N

= V
=

K
1 X Nk
K
N
k=1

1
E
d
FS

i:Zik =1

(39)

0.

d
F
S is a function of (Dk , Rk )1â‰¤kâ‰¤K , and from point
1 PK Nk 1 P
follows from
k=1 N Lk âˆ’1
i:Zik =1 wik Dik (1) =
K

The rst equality follows from the fact that
d) of Assumption 5. The second equality

d
F
S.
P

The third equality follows from point c) of Assumption 5. The last equality follows from

= Lk âˆ’ 1.

i:Zik =1 wik

Finally, the result follows from Equations (31), (38) and (39).

Proof of b)
The proof if fairly similar to that of Point a), so we just sketch it.
Let

1
K

d
F
SI =

PK

P

k=1

i:Z 0 =1
ik
S0

Dik (1)

âˆ’

P
S0 âˆ’ i:Z 0

=1 Dik (1)
ik
N0 âˆ’S0


.

One can show that under points

a), b), d), and e) of Assumption 5,



KV Î²bPI S (Dk , Rk )1â‰¤kâ‰¤K
Then, for every

ÏƒY2 (0)

=



1
S0

+

1
N0 âˆ’S0

2
d
F
SI


.

(40)

k

ï£«
Eï£­



ï£¶
X

Dik (1)ï£¸ = E

0 =1
i:Zik

N0
X

!
1{Rik â‰¤ S0 }Dik (1)

i=1

=E

N0
X
i=1

S0
Dik (1)
N0

!
=

S0 T0
.
N0

The second equality follows from the law of iterated expectations, Assumption 2, and from
point e) of Assumption 5. The third follows from point e) of Assumption 5.
It follows from the previous display that for every

P
E

0 =1 Dik (1)
i:Zik

S0

âˆ’

S0 âˆ’

P

k,

0 =1 Dik (1)
i:Zik

N0 âˆ’ S0

27

!
=

T0
S0 âˆ’ S0 N
T0
T0 âˆ’ S0
0
âˆ’
=
.
N0
N0 âˆ’ S0
N0 âˆ’ S0

(41)

Combining Equations (40) and (41), one can then show that



KV Î²bPI S (Dk , Rk )1â‰¤kâ‰¤K

S0 âˆ’(N0 âˆ’T0 )
S0





1
1
2
+
Ïƒ
N0 âˆ’S0
Y (0) S0
p
.
âˆ’â†’

2

(42)

T0 âˆ’S0
N0 âˆ’S0

N0 âˆ’T0
f ) of Assumption 5.
N0 âˆ’S0 , which is stricly positive under point


bI (Dk , Rk )1â‰¤kâ‰¤K
Together with Equation (40) and Assumption 3, this implies that KV Î²
PS
Finally,

d
F
SI >

âˆ’

is bounded, so Equation (42) implies that





lim E KV Î²bPI S (Dk , Rk )1â‰¤kâ‰¤K



Kâ†’+âˆž

=

ÏƒY2 (0)





1
S0

+

T0 âˆ’S0
N0 âˆ’S0

1
N0 âˆ’S0
2


.

(43)

Then, one can follow the steps used to prove Equation (39) to show that

 

V E Î²bPI S (Dk , Rk )1â‰¤kâ‰¤K
= 0

(44)

Finally, the result follows from the variance decomposition formula and Equations (43) and
(44).

Proof of the sucient condition for lim supV

âˆš


b âˆ’ âˆ†K ) â‰¤
K(âˆ†

Kâ†’+âˆž

One has

0<

T0 âˆ’S0
N0 âˆ’S0

â‰¤

lim V

âˆš

Kâ†’+âˆž


K(Î²bPI S âˆ’ âˆ†K )

T0
N0 , so
1
S0 âˆ’1

+
T0
N0

1
T0 âˆ’S0

â‰¤

1
1
S0 âˆ’1 + T0 âˆ’S0
T0 âˆ’S0
N0 âˆ’S0

.

Then,

1
1
S0 âˆ’1 + T0 âˆ’S0
T0 âˆ’S0
N0 âˆ’S0

â‰¤

1
S0

1
N0 âˆ’S0

2
T0 âˆ’S0
N0 âˆ’S0

+

â‡”

T0 âˆ’ S0
1
1
1
1
T0 âˆ’ S0
1
+
â‰¤
+
â‡”
â‰¤1âˆ’ .
N0 âˆ’ S0 S0 âˆ’ 1 N0 âˆ’ S0
S0 N0 âˆ’ S0
N0 âˆ’ S0
S0

The result follows from the two preceding displays, and using again the fact that

28

T0 âˆ’S0
N0 âˆ’S0

â‰¤

T0
N0 .

